import{_ as s,o as n,c as a,a as l}from"./app.cfee39c0.js";const p="/fe-series-notes/assets/image_zVsWEVIikA.4b99ecc2.png",o="/fe-series-notes/assets/image_k1nl5IkJLR.e2242e32.png",e="/fe-series-notes/assets/image_DbK8iAuosp.7cedaea4.png",c="/fe-series-notes/assets/1680416377724.28e89682.png",t="/fe-series-notes/assets/1680416395702.6bef2b20.png",B=JSON.parse('{"title":"Nginx \u4ECE\u5165\u95E8\u5230\u5B9E\u8DF5","description":"","frontmatter":{},"headers":[{"level":2,"title":"Nginx \u7B80\u4ECB","slug":"nginx-\u7B80\u4ECB","link":"#nginx-\u7B80\u4ECB","children":[{"level":3,"title":"Nginx \u662F\u4EC0\u4E48","slug":"nginx-\u662F\u4EC0\u4E48","link":"#nginx-\u662F\u4EC0\u4E48","children":[]},{"level":3,"title":"nginx \u9002\u7528\u573A\u666F","slug":"nginx-\u9002\u7528\u573A\u666F","link":"#nginx-\u9002\u7528\u573A\u666F","children":[]},{"level":3,"title":"nginx \u5386\u53F2\u80CC\u666F","slug":"nginx-\u5386\u53F2\u80CC\u666F","link":"#nginx-\u5386\u53F2\u80CC\u666F","children":[]},{"level":3,"title":"nginx \u7684\u4F18\u70B9","slug":"nginx-\u7684\u4F18\u70B9","link":"#nginx-\u7684\u4F18\u70B9","children":[]}]},{"level":2,"title":"nginx \u7684\u5B89\u88C5\u548C\u4F7F\u7528","slug":"nginx-\u7684\u5B89\u88C5\u548C\u4F7F\u7528","link":"#nginx-\u7684\u5B89\u88C5\u548C\u4F7F\u7528","children":[{"level":3,"title":"\u5B89\u88C5 Nginx","slug":"\u5B89\u88C5-nginx","link":"#\u5B89\u88C5-nginx","children":[]},{"level":3,"title":"\u542F\u52A8 nginx","slug":"\u542F\u52A8-nginx","link":"#\u542F\u52A8-nginx","children":[]},{"level":3,"title":"\u5E38\u7528\u547D\u4EE4","slug":"\u5E38\u7528\u547D\u4EE4","link":"#\u5E38\u7528\u547D\u4EE4","children":[]}]},{"level":2,"title":"nginx \u914D\u7F6E","slug":"nginx-\u914D\u7F6E","link":"#nginx-\u914D\u7F6E","children":[{"level":3,"title":"\u6587\u4EF6\u7ED3\u6784","slug":"\u6587\u4EF6\u7ED3\u6784","link":"#\u6587\u4EF6\u7ED3\u6784","children":[]},{"level":3,"title":"\u8BED\u6CD5\u8BF4\u660E","slug":"\u8BED\u6CD5\u8BF4\u660E","link":"#\u8BED\u6CD5\u8BF4\u660E","children":[]},{"level":3,"title":"location \u5339\u914D\u89C4\u5219","slug":"location-\u5339\u914D\u89C4\u5219","link":"#location-\u5339\u914D\u89C4\u5219","children":[]},{"level":3,"title":"\u9884\u5B9A\u4E49\u53D8\u91CF","slug":"\u9884\u5B9A\u4E49\u53D8\u91CF","link":"#\u9884\u5B9A\u4E49\u53D8\u91CF","children":[]},{"level":3,"title":"\u4E00\u4E2A\u793A\u4F8B","slug":"\u4E00\u4E2A\u793A\u4F8B","link":"#\u4E00\u4E2A\u793A\u4F8B","children":[]},{"level":3,"title":"server \u865A\u62DF\u4E3B\u673A\u914D\u7F6E","slug":"server-\u865A\u62DF\u4E3B\u673A\u914D\u7F6E","link":"#server-\u865A\u62DF\u4E3B\u673A\u914D\u7F6E","children":[]},{"level":3,"title":"\u7F13\u5B58\u914D\u7F6E","slug":"\u7F13\u5B58\u914D\u7F6E","link":"#\u7F13\u5B58\u914D\u7F6E","children":[]},{"level":3,"title":"\u8DE8\u57DF\u914D\u7F6E","slug":"\u8DE8\u57DF\u914D\u7F6E","link":"#\u8DE8\u57DF\u914D\u7F6E","children":[]},{"level":3,"title":"\u53CD\u5411\u4EE3\u7406","slug":"\u53CD\u5411\u4EE3\u7406","link":"#\u53CD\u5411\u4EE3\u7406","children":[]},{"level":3,"title":"\u8D1F\u8F7D\u5747\u8861","slug":"\u8D1F\u8F7D\u5747\u8861","link":"#\u8D1F\u8F7D\u5747\u8861","children":[]},{"level":3,"title":"\u52A8\u9759\u5206\u79BB","slug":"\u52A8\u9759\u5206\u79BB","link":"#\u52A8\u9759\u5206\u79BB","children":[]},{"level":3,"title":"\u9002\u914D PC \u6216\u79FB\u52A8\u8BBE\u5907","slug":"\u9002\u914D-pc-\u6216\u79FB\u52A8\u8BBE\u5907","link":"#\u9002\u914D-pc-\u6216\u79FB\u52A8\u8BBE\u5907","children":[]},{"level":3,"title":"Gzip \u538B\u7F29","slug":"gzip-\u538B\u7F29","link":"#gzip-\u538B\u7F29","children":[]},{"level":3,"title":"Nginx \u9759\u6001\u538B\u7F29\u548C\u52A8\u6001\u538B\u7F29","slug":"nginx-\u9759\u6001\u538B\u7F29\u548C\u52A8\u6001\u538B\u7F29","link":"#nginx-\u9759\u6001\u538B\u7F29\u548C\u52A8\u6001\u538B\u7F29","children":[]},{"level":3,"title":"\u56FE\u7247\u9632\u76D7\u94FE","slug":"\u56FE\u7247\u9632\u76D7\u94FE","link":"#\u56FE\u7247\u9632\u76D7\u94FE","children":[]}]},{"level":2,"title":"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B","slug":"\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B","link":"#\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B","children":[{"level":3,"title":"TY-Store \u793A\u4F8B","slug":"ty-store-\u793A\u4F8B","link":"#ty-store-\u793A\u4F8B","children":[]}]},{"level":2,"title":"Nginx \u53EF\u89C6\u5316\u914D\u7F6E","slug":"nginx-\u53EF\u89C6\u5316\u914D\u7F6E","link":"#nginx-\u53EF\u89C6\u5316\u914D\u7F6E","children":[]},{"level":2,"title":"\u8FDB\u9636\u5B66\u4E60\u8D44\u6599","slug":"\u8FDB\u9636\u5B66\u4E60\u8D44\u6599","link":"#\u8FDB\u9636\u5B66\u4E60\u8D44\u6599","children":[]}],"relativePath":"deploy/100-Nginx\u4ECE\u5165\u95E8\u5230\u5B9E\u8DF5.md","lastUpdated":1680849633000}'),r={name:"deploy/100-Nginx\u4ECE\u5165\u95E8\u5230\u5B9E\u8DF5.md"},i=l('<h1 id="nginx-\u4ECE\u5165\u95E8\u5230\u5B9E\u8DF5" tabindex="-1">Nginx \u4ECE\u5165\u95E8\u5230\u5B9E\u8DF5 <a class="header-anchor" href="#nginx-\u4ECE\u5165\u95E8\u5230\u5B9E\u8DF5" aria-hidden="true">#</a></h1><h2 id="nginx-\u7B80\u4ECB" tabindex="-1">Nginx \u7B80\u4ECB <a class="header-anchor" href="#nginx-\u7B80\u4ECB" aria-hidden="true">#</a></h2><h3 id="nginx-\u662F\u4EC0\u4E48" tabindex="-1">Nginx \u662F\u4EC0\u4E48 <a class="header-anchor" href="#nginx-\u662F\u4EC0\u4E48" aria-hidden="true">#</a></h3><p>nginx (engine x) \u662F\u4E00\u4E2A HTTP \u548C\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u4E00\u4E2A\u90AE\u4EF6\u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u4E00\u4E2A\u901A\u7528\u7684 TCP/UDP \u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u6700\u521D\u7531 Igor Sysoev \u7F16\u5199\u3002\u5B9E\u9645\u5728\u5728\u8BBE\u8BA1\u4E4B\u521D<strong>Nginx</strong>\u7684\u4EA7\u54C1\u76EE\u7684\u5C31\u662F\u4E3A\u4E86\u90AE\u4EF6\u670D\u52A1\u800C\u8BDE\u751F\u7684\uFF0C\u7279\u70B9\u662F\u5360\u6709\u5185\u5B58\u5C11\u3001\u4F53\u79EF\u5C0F\u3001\u5E76\u53D1\u80FD\u529B\u5F3A\u3001\u6027\u80FD\u9AD8\u3002</p><h3 id="nginx-\u9002\u7528\u573A\u666F" tabindex="-1">nginx \u9002\u7528\u573A\u666F <a class="header-anchor" href="#nginx-\u9002\u7528\u573A\u666F" aria-hidden="true">#</a></h3><p><img src="'+p+`" alt=""></p><p>Nginx \u7684\u4E09\u4E2A\u4E3B\u8981\u5E94\u7528\u573A\u666F\uFF1A</p><p><strong>1\u3001\u9759\u6001\u8D44\u6E90\u670D\u52A1</strong></p><p>\u9759\u6001\u8D44\u6E90\u76F4\u63A5\u53EF\u4EE5\u7531 nginx \u63D0\u4F9B\u670D\u52A1\uFF0C\u964D\u4F4E\u5BF9\u540E\u53F0\u5E94\u7528\u8BBF\u95EE\u3002</p><p><strong>2\u3001\u53CD\u5411\u4EE3\u7406</strong></p><ul><li>\u901A\u8FC7\u53CD\u5411\u4EE3\u7406\u8BBF\u95EE\u540E\u7AEF\u63A5\u53E3</li><li>\u540E\u7AEF\u5E94\u7528\u670D\u52A1\u6784\u6210\u96C6\u7FA4\u540E\uFF0C\u9700\u8981\u52A8\u6001\u6269\u5BB9\uFF0C\u6709\u7684\u5E94\u7528\u51FA\u95EE\u9898\u4E86\u9700\u8981\u505A\u5BB9\u707E\uFF0C\u90A3\u4E48\u9700\u8981 nginx \u8D1F\u8F7D\u5747\u8861\u529F\u80FD</li><li>\u901A\u8FC7\u7F13\u5B58\u529F\u80FD\uFF0C\u52A0\u5FEB\u8D44\u6E90\u8BBF\u95EE\u3002</li></ul><p><strong>3\u3001API \u670D\u52A1</strong></p><p>\u6570\u636E\u5E93\u670D\u52A1\u7684\u6027\u80FD\uFF0C\u8FDC\u9AD8\u4E8E\u540E\u7AEF\u5E94\u7528\u670D\u52A1\uFF0C\u6240\u4EE5\u53EF\u4EE5\u884D\u751F\u51FA\u76F4\u63A5\u4F7F\u7528 nginx \u8BBF\u95EE\u6570\u636E\u5E93\u6216\u8005 redis\uFF0C\u5229\u7528 nginx \u7684\u9AD8\u5E76\u53D1\u6027\u80FD\uFF0C\u5B9E\u73B0\u5982 web \u9632\u706B\u5899\u7B49\u590D\u6742\u7684\u4E1A\u52A1\u529F\u80FD\u3002\u5982 OpenResty \u5DE5\u5177\u3002</p><h3 id="nginx-\u5386\u53F2\u80CC\u666F" tabindex="-1">nginx \u5386\u53F2\u80CC\u666F <a class="header-anchor" href="#nginx-\u5386\u53F2\u80CC\u666F" aria-hidden="true">#</a></h3><p><code>C10K</code> \u95EE\u9898\u662F Nginx \u62A2\u5360\u821E\u53F0\u7684\u4E3B\u8981\u539F\u56E0\u3002</p><p>\u968F\u7740\u4E92\u8054\u7F51\u6570\u636E\u7684\u5FEB\u901F\u589E\u957F\uFF0C\u5BF9\u6211\u4EEC\u7684\u786C\u4EF6\u8BBE\u5907\u548C\u6027\u80FD\u63D0\u51FA\u4E86\u5F88\u9AD8\u7684\u8981\u6C42\u3002\u6839\u636E\u6469\u5C14\u5B9A\u4E49\uFF0C\u786C\u4EF6\u6027\u80FD\u5F97\u5230\u5F88\u5927\u63D0\u5347\uFF0C\u4F46\u662F\u4F4E\u6548\u7684 Apache \u62D6\u7D2F\u4E86\u6027\u80FD\uFF0C\u5BFC\u81F4\u786C\u4EF6\u7684\u6027\u80FD\u6CA1\u6709\u5F97\u5230\u6700\u5927\u7684\u53D1\u6325\u3002\u56E0\u4E3A Apache \u7684\u4E00\u4E2A\u8FDB\u7A0B\u5728\u540C\u4E00\u65F6\u95F4\u53EA\u80FD\u5904\u7406\u4E00\u4E2A\u8FDE\u63A5\uFF0C\u5BFC\u81F4\u9AD8\u5E76\u53D1\u7684\u65F6\u5019\uFF0C\u8FDB\u7A0B\u95F4\u5207\u6362\u4F1A\u6D88\u8017\u5927\u91CF\u7684\u6027\u80FD\u3002</p><p>1999 \u5E74\u7684\u4E00\u4E2A\u6674\u6717\u7684\u65E9\u6668\uFF0CDan Kegel \u53D1\u73B0\u4E86\u6240\u6709\u4F20\u7EDF Web \u670D\u52A1\u5668\u90FD\u65E0\u6CD5\u5904\u7406 10K \u5E76\u53D1\u5BA2\u6237\u7AEF/\u8FDE\u63A5\u7684\u95EE\u9898\uFF0C\u5E76\u5C06\u5176\u547D\u540D\u4E3A C10K \u95EE\u9898\u3002\u8FD9\u4E2A\u7F29\u5199\u4E2D\u7684 C \u4EE3\u8868\u5E76\u53D1\u8FDE\u63A5\u6570\uFF0C10K \u4EE3\u8868\u6570\u5B57\u3002\u4E00\u8D77\uFF0C\u5B83\u5C06\u95EE\u9898\u8868\u793A\u4E3A 10K \u5E76\u53D1\u8FDE\u63A5\u95EE\u9898\u3002</p><h3 id="nginx-\u7684\u4F18\u70B9" tabindex="-1">nginx \u7684\u4F18\u70B9 <a class="header-anchor" href="#nginx-\u7684\u4F18\u70B9" aria-hidden="true">#</a></h3><ul><li>\u9AD8\u5E76\u53D1\uFF0C\u9AD8\u6027\u80FD</li><li>\u53EF\u6269\u5C55\u6027\u597D\uFF1A\u6A21\u5757\u5316\u8BBE\u8BA1\uFF0C\u751F\u6001\u5708\u597D\uFF0C\u5982 <code>Tengine</code></li><li>\u9AD8\u53EF\u9760\u6027\uFF1A\u6301\u7EED\u8FD0\u884C\u6570\u5E74</li><li>\u70ED\u90E8\u7F72\uFF1A\u4E0D\u505C\u6B62\u670D\u52A1\u7684\u65F6\u5019\u5347\u7EA7 Nginx</li><li>BSD \u8BB8\u53EF\u8BC1\uFF1A\u5F00\u6E90\u514D\u8D39\uFF0C\u53EF\u4EE5\u4FEE\u6539\u6E90\u7801\u5E76\u5546\u7528</li></ul><h2 id="nginx-\u7684\u5B89\u88C5\u548C\u4F7F\u7528" tabindex="-1">nginx \u7684\u5B89\u88C5\u548C\u4F7F\u7528 <a class="header-anchor" href="#nginx-\u7684\u5B89\u88C5\u548C\u4F7F\u7528" aria-hidden="true">#</a></h2><p>\u4E00\u822C\u6211\u4EEC\u90FD\u4F1A\u4F7F\u7528 Linux \u4E0B\u8FDB\u884C\u90E8\u7F72\u670D\u52A1\uFF0C\u6240\u4EE5 window \u7248\u672C\u6682\u4E0D\u505A\u8003\u8651\u3002</p><h3 id="\u5B89\u88C5-nginx" tabindex="-1">\u5B89\u88C5 Nginx <a class="header-anchor" href="#\u5B89\u88C5-nginx" aria-hidden="true">#</a></h3><div class="info custom-block"><p class="custom-block-title">\u{1F4A1} \u5173\u4E8E yum</p><p>\u76F8\u4FE1\u4F60\u6BCF\u5929\u90FD\u5728\u4F7F\u7528 <code>npm</code>\uFF0Cnpm \u662F\u4E00\u4E2A\u5305\u7BA1\u7406\u5DE5\u5177\uFF0C\u53EF\u5728\u672C\u5730\u73AF\u5883\u4E2D\u8F7B\u677E\u64CD\u4F5C\u5404\u79CD\u5305\u5E94\u7528\u3002\u5F53\u7136 <code>CentOS</code>\u4E5F\u6709\u4E00\u4E2A\u76F8\u5F53 npm \u90A3\u6837\u7684\u5305\u7BA1\u7406\u5DE5\u5177\uFF0C\u53EF\u5728\u670D\u52A1\u5668\u73AF\u5883\u4E2D\u8F7B\u677E\u7BA1\u7406\u5404\u79CD npm \u6A21\u5757\u3002</p><p><code>yum</code>\u662F\u4E00\u4E2A\u5728 <code>Fedora</code>\u3001<code>RedHat</code>\u548C <code>CentOS</code>\u4E2D\u7684<strong>Shell \u8F6F\u4EF6\u5305\u7BA1\u7406\u5668</strong>\u3002\u5176\u57FA\u4E8E <code>rpm\u5305\u7BA1\u7406</code>\uFF0C\u53EF\u4ECE\u6307\u5B9A\u7684\u670D\u52A1\u5668\u81EA\u52A8\u5B89\u88C5 <code>rpm\u5305</code>\uFF0C\u53EF\u81EA\u52A8\u5904\u7406\u4F9D\u8D56\u5173\u7CFB\u5E76\u4E00\u6B21\u6027\u5730\u5B89\u88C5\u6240\u6709\u4F9D\u8D56\u7684\u8F6F\u4EF6\u5305\uFF0C\u6574\u4E2A\u8FC7\u7A0B\u4E0E <code>npm</code>\u6709\u70B9\u50CF\uFF0C\u53EA\u9700\u638C\u63E1\u4EE5\u4E0B\u547D\u4EE4\u5C31\u80FD\u64CD\u4F5C <code>yum</code>\u3002</p><p>\u6CE8\u610F\uFF1A\u5728 ubuntu \u91CC\u9762\u5C31\u4E0D\u662F <code>yum</code>\u4E86\uFF0C\u5728 Ubuntu \u4E2D\uFF0C\u7C7B\u4F3C\u4E8E yum \u7684\u5305\u7BA1\u7406\u5668\u662F <code>apt</code>\uFF08Advanced Package Tool\uFF09\u3002</p></div><p>\u4E0B\u9762\u4EE5 <code>CentOS</code>\u73AF\u5883\u4E3A\u4F8B\uFF1A</p><p>\u9996\u5148\u68C0\u6D4B yum \u6E90\u4E2D\u6709\u65E0 nginx</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">yum</span><span style="color:#C9D1D9;"> list | grep nginx</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u5B58\u5728\uFF0C\u5728\u5B89\u88C5 nginx\uFF1A</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">yum</span><span style="color:#C9D1D9;"> install nginx</span></span>
<span class="line"></span></code></pre></div><p>\u518D\u6267\u884C <code>nginx -v</code>\uFF0C\u8F93\u51FA\u7248\u672C\u8868\u793A\u5B89\u88C5\u6210\u529F\u3002</p><p>\u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u6216\u8005\u4E0D\u662F\u4F60\u9700\u8981\u7684\u7248\u672C\uFF0C\u9700\u8981**<a href="https://jspang.com/article/39?spm=wolai.workspace.0.0.139b27a46cog40#toc2" target="_blank" rel="noreferrer">\u81EA\u884C\u914D\u7F6E yum \u6E90</a>**\u3002</p><h3 id="\u542F\u52A8-nginx" tabindex="-1">\u542F\u52A8 nginx <a class="header-anchor" href="#\u542F\u52A8-nginx" aria-hidden="true">#</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki"><code><span class="line"><span style="color:#c9d1d9;">nginx</span></span>
<span class="line"><span style="color:#c9d1d9;"></span></span></code></pre></div><p>\u542F\u52A8 <code>Nginx</code>\u540E\uFF0C\u5728\u6D4F\u89C8\u5668\u6253\u5F00\u516C\u7F51 IP\uFF0C\u5C31\u53EF\u4EE5\u770B\u5230 nginx \u542F\u52A8\u9875\u9762\u3002</p><blockquote><p>\u6CE8\u610F\u9700\u8981\u5728\u963F\u91CC\u4E91\u914D\u7F6E 80 \u7AEF\u53E3\u5B89\u5168\u7EC4\u3002</p></blockquote><h3 id="\u5E38\u7528\u547D\u4EE4" tabindex="-1">\u5E38\u7528\u547D\u4EE4 <a class="header-anchor" href="#\u5E38\u7528\u547D\u4EE4" aria-hidden="true">#</a></h3><p>\u5F97\u76CA\u5176\u5B89\u5168\u7A33\u5B9A\u7684\u7279\u6027\uFF0C\u82E5\u672A\u9047\u5230\u7279\u6B8A\u60C5\u51B5\u51E0\u4E4E\u90FD\u4E0D\u4F1A\u518D\u91CD\u542F\uFF0C\u53EA\u9700\u638C\u63E1\u4EE5\u4E0B\u547D\u4EE4\u5C31\u80FD\u64CD\u4F5C <code>nginx</code>\uFF1A</p><table><thead><tr><th>\u547D\u4EE4</th><th>\u529F\u80FD</th></tr></thead><tbody><tr><td><code>nginx</code></td><td>\u542F\u52A8\u8FDB\u7A0B</td></tr><tr><td><code>nginx -t</code></td><td>\u9A8C\u8BC1\u914D\u7F6E</td></tr><tr><td><code>nginx -s reload</code></td><td>\u91CD\u542F\u8FDB\u7A0B</td></tr><tr><td><code>nginx -s stop</code></td><td>\u5F3A\u5236\u9000\u51FA</td></tr><tr><td><code>nginx -s quit</code></td><td>\u5B89\u5168\u9000\u51FA</td></tr><tr><td><code>ps -ef | grep nginx</code></td><td>\u67E5\u770B\u8FDB\u7A0B</td></tr></tbody></table><blockquote><p>Linux \u6BCF\u4E2A\u5E94\u7528\u8FD0\u884C\u90FD\u4F1A\u4EA7\u751F\u4E00\u4E2A\u8FDB\u7A0B\uFF0C\u90A3\u4E48\u6211\u4EEC\u5C31\u53EF\u4EE5\u901A\u8FC7\u67E5\u770B Nginx \u8FDB\u7A0B\u662F\u5426\u5B58\u5728\u6765\u5224\u65AD\u5B83\u662F\u5426\u542F\u52A8\u3002 <strong>\u7528 ps -ef \u5217\u51FA\u8FDB\u7A0B\u5217\u8868\uFF0C\u7136\u540E\u901A\u8FC7 grep \u8FC7\u6EE4</strong>\u3002 \u5982\uFF1A ps -ef | grep nginx \u5C31\u53EF\u4EE5\u770B\u5230 Nginx \u8FDB\u7A0B\u662F\u5426\u5B58\u5728\u4E86\u3002</p></blockquote><h2 id="nginx-\u914D\u7F6E" tabindex="-1">nginx \u914D\u7F6E <a class="header-anchor" href="#nginx-\u914D\u7F6E" aria-hidden="true">#</a></h2><h3 id="\u6587\u4EF6\u7ED3\u6784" tabindex="-1"><strong>\u6587\u4EF6\u7ED3\u6784</strong> <a class="header-anchor" href="#\u6587\u4EF6\u7ED3\u6784" aria-hidden="true">#</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">...    </span><span style="color:#8B949E;"># \u5168\u5C40\u914D\u7F6E\uFF0C\u5BF9\u5168\u5C40\u751F\u6548</span></span>
<span class="line"><span style="color:#FF7B72;">events</span><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># \u914D\u7F6E\u5F71\u54CD Nginx \u670D\u52A1\u5668\u6216\u4E0E\u7528\u6237\u7684\u7F51\u7EDC\u8FDE\u63A5</span></span>
<span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># \u914D\u7F6E\u4EE3\u7406\uFF0C\u7F13\u5B58\uFF0C\u65E5\u5FD7\u5B9A\u4E49\u7B49\u7EDD\u5927\u591A\u6570\u529F\u80FD\u548C\u7B2C\u4E09\u65B9\u6A21\u5757\u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u251C\u2500\u2500 </span><span style="color:#FF7B72;">upstream</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;"># \u914D\u7F6E\u540E\u7AEF\u670D\u52A1\u5668\u5177\u4F53\u5730\u5740\uFF0C\u8D1F\u8F7D\u5747\u8861\u914D\u7F6E\u4E0D\u53EF\u6216\u7F3A\u7684\u90E8\u5206</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u251C\u2500\u2500 </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;">   </span><span style="color:#8B949E;"># \u914D\u7F6E\u865A\u62DF\u4E3B\u673A\u7684\u76F8\u5173\u53C2\u6570\uFF0C\u4E00\u4E2A http \u5757\u4E2D\u53EF\u4EE5\u6709\u591A\u4E2A server \u5757</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u251C\u2500\u2500 server</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u2502   \u251C\u2500\u2500 location  </span><span style="color:#8B949E;"># server \u5757\u53EF\u4EE5\u5305\u542B\u591A\u4E2A location \u5757\uFF0Clocation \u6307\u4EE4\u7528\u4E8E\u5339\u914D uri</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u2502   \u251C\u2500\u2500 location</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u2502   \u2514\u2500\u2500 ...</span></span>
<span class="line"><span style="color:#C9D1D9;">  \u2514\u2500\u2500 ...</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>1\u3001 <strong>\u5168\u5C40\u5757</strong> \uFF1A\u300C\u5F71\u54CD nginx \u670D\u52A1\u5668\u6574\u4F53\u914D\u7F6E\u7684\u6307\u4EE4\u300D\u3002\u4E00\u822C\u6709\u8FD0\u884C nginx \u670D\u52A1\u5668\u7684\u7528\u6237\u7EC4\uFF0Cnginx \u8FDB\u7A0B pid \u5B58\u653E\u8DEF\u5F84\uFF0C\u65E5\u5FD7\u5B58\u653E\u8DEF\u5F84\uFF0C\u914D\u7F6E\u6587\u4EF6\u5F15\u5165\uFF0C\u5141\u8BB8\u751F\u6210 worker process \u6570\u7B49\u3002</li><li>2\u3001 <strong>events \u5757</strong> \uFF1A\u5F71\u54CD\u300CNginx \u670D\u52A1\u5668\u4E0E\u7528\u6237\u7684\u7F51\u7EDC\u8FDE\u63A5\u300D\u3002\u6709\u6BCF\u4E2A\u8FDB\u7A0B\u7684\u6700\u5927\u8FDE\u63A5\u6570\uFF0C\u9009\u53D6\u54EA\u79CD\u4E8B\u4EF6\u9A71\u52A8\u6A21\u578B\u5904\u7406\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u662F\u5426\u5141\u8BB8\u540C\u65F6\u63A5\u53D7\u591A\u4E2A\u7F51\u8DEF\u8FDE\u63A5\uFF0C\u5F00\u542F\u591A\u4E2A\u7F51\u7EDC\u8FDE\u63A5\u5E8F\u5217\u5316\u7B49\u3002</li><li>3\u3001 <strong>http \u5757</strong> \uFF1A\u4EE3\u7406\u3001\u7F13\u5B58\u3001\u65E5\u5FD7\u7B49\u7EDD\u5927\u591A\u6570\u529F\u80FD\u548C\u7B2C\u4E09\u65B9\u6A21\u5757\u7684\u914D\u7F6E\u529F\u80FD\uFF08\u53EF\u4EE5\u5D4C\u5957\u591A\u4E2A server\uFF09\u3002\u5982\u6587\u4EF6\u5F15\u5165\uFF0Cmime-type \u5B9A\u4E49\uFF0C\u65E5\u5FD7\u81EA\u5B9A\u4E49\uFF0C\u662F\u5426\u4F7F\u7528 sendfile \u4F20\u8F93\u6587\u4EF6\uFF0C\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4\uFF0C\u5355\u8FDE\u63A5\u8BF7\u6C42\u6570\u7B49\u3002</li><li>4\u3001 <strong>server \u5757</strong> \uFF1A\u4E3B\u8981\u7528\u4E8E\u5236\u5B9A\u865A\u62DF\u4E3B\u673A\u57DF\u540D\u3001IP \u548C\u7AEF\u53E3\u53F7\uFF0C\u4E00\u4E2A http \u4E2D\u53EF\u4EE5\u6709\u591A\u4E2A server\u3002</li><li>5\u3001 <strong>location \u5757</strong> \uFF1A\u914D\u7F6E\u8BF7\u6C42\u7684\u8DEF\u7531\uFF0C\u4EE5\u53CA\u5404\u79CD\u9875\u9762\u7684\u5904\u7406\u60C5\u51B5\u3002</li></ul><blockquote><p>\u4ED6\u4EEC\u4E4B\u95F4\u7684\u5173\u7CFB\uFF1Aserver \u7EE7\u627F main\uFF0Clocation \u7EE7\u627F server\uFF1Bupstream \u65E2\u4E0D\u4F1A\u7EE7\u627F\u6307\u4EE4\u4E5F\u4E0D\u4F1A\u88AB\u7EE7\u627F\u3002</p></blockquote><h3 id="\u8BED\u6CD5\u8BF4\u660E" tabindex="-1">\u8BED\u6CD5\u8BF4\u660E <a class="header-anchor" href="#\u8BED\u6CD5\u8BF4\u660E" aria-hidden="true">#</a></h3><ul><li>\u914D\u7F6E\u6587\u4EF6\u7531 <code>\u6307\u4EE4</code>\u4E0E <code>\u6307\u4EE4\u5757</code>\u7EC4\u6210</li><li>\u6307\u4EE4\u4EE5 <code>\u5206\u53F7</code>\u7ED3\u5C3E\uFF0C\u6307\u4EE4\u4E0E\u53C2\u6570\u4EE5 <code>\u7A7A\u683C</code>\u5206\u9694</li><li>\u6307\u4EE4\u5757\u4EE5 <code>\u5927\u62EC\u53F7</code>\u5C06\u591A\u6761\u6307\u4EE4\u7EC4\u7EC7\u5728\u4E00\u8D77</li><li>\u4F7F\u7528 <code>$</code>\u8868\u793A\u53D8\u91CF\uFF0C\u63D0\u9AD8\u590D\u7528\u6027</li><li>\u4F7F\u7528 <code>#</code>\u52A0\u5165\u6CE8\u91CA\uFF0C\u63D0\u9AD8\u53EF\u8BFB\u6027</li><li>\u90E8\u5206\u6307\u4EE4\u7684\u53C2\u6570\u652F\u6301\u6B63\u5219\u8868\u8FBE\u5F0F</li><li><code>include</code>\u8BED\u53E5\u5141\u8BB8\u7EC4\u5408\u591A\u4E2A\u914D\u7F6E\u6587\u4EF6\u4EE5\u63D0\u5347\u914D\u7F6E\u7684\u53EF\u7EF4\u62A4\u6027</li></ul><p>\u4E00\u4E2A\u7B80\u5355\u7684 nginx \u914D\u7F6E\u793A\u4F8B\uFF1A</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">user </span><span style="color:#C9D1D9;"> nginx;                        </span><span style="color:#8B949E;"># \u8FD0\u884C\u7528\u6237\uFF0C\u9ED8\u8BA4\u5373\u662Fnginx\uFF0C\u53EF\u4EE5\u4E0D\u8FDB\u884C\u8BBE\u7F6E</span></span>
<span class="line"><span style="color:#FF7B72;">worker_processes </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;">;                </span><span style="color:#8B949E;"># Nginx \u8FDB\u7A0B\u6570\uFF0C\u4E00\u822C\u8BBE\u7F6E\u4E3A\u548C CPU \u6838\u6570\u4E00\u6837</span></span>
<span class="line"><span style="color:#FF7B72;">error_log </span><span style="color:#C9D1D9;"> /var/log/nginx/error.log</span><span style="color:#79C0FF;"> warn</span><span style="color:#C9D1D9;">;   </span><span style="color:#8B949E;"># Nginx \u7684\u9519\u8BEF\u65E5\u5FD7\u5B58\u653E\u76EE\u5F55</span></span>
<span class="line"><span style="color:#FF7B72;">pid </span><span style="color:#C9D1D9;">       /var/run/nginx.pid;      </span><span style="color:#8B949E;"># Nginx \u670D\u52A1\u542F\u52A8\u65F6\u7684 pid \u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">events</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> use </span><span style="color:#C9D1D9;">epoll;     </span><span style="color:#8B949E;"># \u4F7F\u7528epoll\u7684I/O\u6A21\u578B(\u5982\u679C\u4F60\u4E0D\u77E5\u9053Nginx\u8BE5\u4F7F\u7528\u54EA\u79CD\u8F6E\u8BE2\u65B9\u6CD5\uFF0C\u4F1A\u81EA\u52A8\u9009\u62E9\u4E00\u4E2A\u6700\u9002\u5408\u4F60\u64CD\u4F5C\u7CFB\u7EDF\u7684)</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> worker_connections </span><span style="color:#C9D1D9;">1024;   </span><span style="color:#8B949E;"># \u6BCF\u4E2A\u8FDB\u7A0B\u5141\u8BB8\u6700\u5927\u5E76\u53D1\u6570</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;"> {   </span><span style="color:#8B949E;"># \u914D\u7F6E\u4F7F\u7528\u6700\u9891\u7E41\u7684\u90E8\u5206\uFF0C\u4EE3\u7406\u3001\u7F13\u5B58\u3001\u65E5\u5FD7\u5B9A\u4E49\u7B49\u7EDD\u5927\u591A\u6570\u529F\u80FD\u548C\u7B2C\u4E09\u65B9\u6A21\u5757\u7684\u914D\u7F6E\u90FD\u5728\u8FD9\u91CC\u8BBE\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># \u8BBE\u7F6E\u65E5\u5FD7\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> log_format </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">  </span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#C9D1D9;">remote_addr</span><span style="color:#A5D6FF;"> - $</span><span style="color:#C9D1D9;">remote_user</span><span style="color:#A5D6FF;"> [$</span><span style="color:#C9D1D9;">time_local</span><span style="color:#A5D6FF;">] &quot;$</span><span style="color:#C9D1D9;">request</span><span style="color:#A5D6FF;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">                      </span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#C9D1D9;">status</span><span style="color:#A5D6FF;"> $</span><span style="color:#C9D1D9;">body_bytes_sent</span><span style="color:#A5D6FF;"> &quot;$</span><span style="color:#C9D1D9;">http_referer</span><span style="color:#A5D6FF;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">                      </span><span style="color:#A5D6FF;">&#39;&quot;$</span><span style="color:#C9D1D9;">http_user_agent</span><span style="color:#A5D6FF;">&quot; &quot;$</span><span style="color:#C9D1D9;">http_x_forwarded_for</span><span style="color:#A5D6FF;">&quot;&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> access_log </span><span style="color:#C9D1D9;"> /var/log/nginx/access.log </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">;   </span><span style="color:#8B949E;"># Nginx\u8BBF\u95EE\u65E5\u5FD7\u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> sendfile </span><span style="color:#C9D1D9;">          </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;   </span><span style="color:#8B949E;"># \u5F00\u542F\u9AD8\u6548\u4F20\u8F93\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> tcp_nopush </span><span style="color:#C9D1D9;">        </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;   </span><span style="color:#8B949E;"># \u51CF\u5C11\u7F51\u7EDC\u62A5\u6587\u6BB5\u7684\u6570\u91CF</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> tcp_nodelay </span><span style="color:#C9D1D9;">       </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> keepalive_timeout </span><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">65</span><span style="color:#C9D1D9;">;   </span><span style="color:#8B949E;"># \u4FDD\u6301\u8FDE\u63A5\u7684\u65F6\u95F4\uFF0C\u4E5F\u53EB\u8D85\u65F6\u65F6\u95F4\uFF0C\u5355\u4F4D\u79D2</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> types_hash_max_size </span><span style="color:#C9D1D9;">2048;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;                 </span><span style="color:#8B949E;">#\u5F00\u542Fgzip\u538B\u7F29</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> include </span><span style="color:#C9D1D9;">            /etc/nginx/mime.types;      </span><span style="color:#8B949E;"># \u6587\u4EF6\u6269\u5C55\u540D\u4E0E\u7C7B\u578B\u6620\u5C04\u8868</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> default_type </span><span style="color:#C9D1D9;">       application/octet-stream;   </span><span style="color:#8B949E;"># \u9ED8\u8BA4\u6587\u4EF6\u7C7B\u578B</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> include </span><span style="color:#C9D1D9;">/etc/nginx/conf.d/*.conf;   </span><span style="color:#8B949E;"># \u5305\u542B\u7684\u5B50\u914D\u7F6E\u9879\u4F4D\u7F6E\u548C\u6587\u4EF6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">      </span><span style="color:#79C0FF;">80</span><span style="color:#C9D1D9;">;       </span><span style="color:#8B949E;"># \u914D\u7F6E\u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;"> localhost;    </span><span style="color:#8B949E;"># \u914D\u7F6E\u7684\u57DF\u540D</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">  /usr/share/nginx/html;  </span><span style="color:#8B949E;"># \u7F51\u7AD9\u6839\u76EE\u5F55</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;"> index.html index.htm;   </span><span style="color:#8B949E;"># \u9ED8\u8BA4\u9996\u9875\u6587\u4EF6</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> deny </span><span style="color:#C9D1D9;">172.168.22.11;   </span><span style="color:#8B949E;"># \u7981\u6B62\u8BBF\u95EE\u7684ip\u5730\u5740\uFF0C\u53EF\u4EE5\u4E3Aall</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> allow </span><span style="color:#C9D1D9;">172.168.33.44\uFF1B </span><span style="color:#8B949E;"># \u5141\u8BB8\u8BBF\u95EE\u7684ip\u5730\u5740\uFF0C\u53EF\u4EE5\u4E3Aall</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">      error_page </span><span style="color:#79C0FF;">500</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">502</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">503</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">504</span><span style="color:#C9D1D9;"> /50x.html;  </span><span style="color:#8B949E;"># \u9ED8\u8BA450x\u5BF9\u5E94\u7684\u8BBF\u95EE\u9875\u9762</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> error_page </span><span style="color:#C9D1D9;">400 </span><span style="color:#79C0FF;">404</span><span style="color:#C9D1D9;"> error.html;   </span><span style="color:#8B949E;"># \u540C\u4E0A</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="location-\u5339\u914D\u89C4\u5219" tabindex="-1">location \u5339\u914D\u89C4\u5219 <a class="header-anchor" href="#location-\u5339\u914D\u89C4\u5219" aria-hidden="true">#</a></h3><blockquote><p><strong>\u6CE8\u610F\uFF1Alocation \u5339\u914D\u7684\u4E0D\u662F url \u8DEF\u7531\u5730\u5740\uFF0C\u800C\u662F\u5BF9\u4E8E\u670D\u52A1\u5668\u4E2D\u7684\u76EE\u5F55\u6216\u8005\u6587\u4EF6\u3002</strong></p></blockquote><ul><li><code>/</code>\uFF1A\u901A\u7528\u5339\u914D\uFF0C\u4EFB\u4F55\u5185\u5BB9\u8BF7\u6C42\u90FD\u4F1A\u5339\u914D\u5230</li><li><code>=</code>\uFF1A\u8FDB\u884C\u666E\u901A\u5B57\u7B26\u5339\u914D\u3002\u4E5F\u5C31\u662F\u5B8C\u5168\u5339\u914D\u3002</li><li><code>^~</code>\uFF1A\u524D\u7F00\u5339\u914D\u3002\u5982\u679C\u5339\u914D\u6210\u529F\uFF0C\u5219\u4E0D\u518D\u5339\u914D\u5176\u4ED6 location\u3002</li><li><code>~</code>\uFF1A\u8868\u793A\u6267\u884C\u4E00\u4E2A\u6B63\u5219\u5339\u914D\uFF0C\u533A\u5206\u5927\u5C0F\u5199</li><li><code>~*</code>\uFF1A\u8868\u793A\u6267\u884C\u4E00\u4E2A\u6B63\u5219\u5339\u914D\uFF0C\u4E0D\u533A\u5206\u5927\u5C0F\u5199</li><li><code>/xxx/</code>\uFF1A\u5E38\u89C4\u5B57\u7B26\u4E32\u8DEF\u5F84\u5339\u914D</li></ul><p>\u66F4\u591A\u53C2\u8003\uFF1A<a href="https://z.itpub.net/article/detail/03489CAF30DD7EB79B9E239E941FA82D" target="_blank" rel="noreferrer">https://z.itpub.net/article/detail/03489CAF30DD7EB79B9E239E941FA82D</a></p><h3 id="\u9884\u5B9A\u4E49\u53D8\u91CF" tabindex="-1">\u9884\u5B9A\u4E49\u53D8\u91CF <a class="header-anchor" href="#\u9884\u5B9A\u4E49\u53D8\u91CF" aria-hidden="true">#</a></h3><p>nginx \u9884\u5B9A\u4E49\u53D8\u91CF\u4E5F\u53EB\u5168\u5C40\u53D8\u91CF\u3002</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">$arg_PARAMNETER GET\u8BF7\u6C42\u53D8\u91CF\u540DPARAMEMTER\u53C2\u6570\u7684\u503C</span></span>
<span class="line"><span style="color:#C9D1D9;">$args \u8FD9\u4E2A\u53D8\u91CF\u7B49\u4E8EGet \u8BF7\u6C42\u4E2D\u7684\u53C2\u6570</span></span>
<span class="line"><span style="color:#C9D1D9;">$body_bytes_sent \u4F20\u9001\u9875\u9762\u7684\u5B57\u8282\u6570</span></span>
<span class="line"><span style="color:#C9D1D9;">$content_length  \u8BF7\u6C42\u5934\u4E2D\u53D1\u70EDcontent-lenth\u5B57\u6BB5</span></span>
<span class="line"><span style="color:#C9D1D9;">$content_type   \u8BF7\u6C42\u5934\u4E2D\u7684Content-Type\u5B57\u6BB5\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$cookie_COOKIE  cookie COOKIE\u7684\u503C\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$document_root  \u5F53\u524D\u8BF7\u6C42\u5728root\u6307\u4EE4\u4E2D\u6307\u5B9A\u7684\u503C</span></span>
<span class="line"><span style="color:#C9D1D9;">$document_uri  \u4E0E$uri\u76F8\u540C</span></span>
<span class="line"><span style="color:#C9D1D9;">$host      \u8BF7\u6C42\u4E2D\u7684\u4E3B\u673A\u5934(Host)\u5B57\u6BB5\uFF0C\u5982\u679C\u8BF7\u6C42\u4E2D\u7684\u4E3B\u673A\u5934\u4E0D\u53EF\u7528\u6216\u8005\u7A7A\uFF0C\u5219\u4E3A\u5904\u7406\u8BF7\u6C42\u7684server\u540D\u79F0(\u5904\u7406\u8BF7\u6C42\u7684server\u7684server_name\u6307\u4EE4\u7684\u503C)\u3002\u503C\u4E3A\u5C0F\u5199\uFF0C\u4E0D\u5305\u542B\u7AEF\u53E3\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$hostname\u673A\u5668\u540D\u4F7F\u7528 gethostname\u7CFB\u7EDF\u8C03\u7528\u7684\u503C</span></span>
<span class="line"><span style="color:#C9D1D9;">$http_HEADER   HTTP\u8BF7\u6C42\u5934\u4E2D\u7684\u5185\u5BB9\uFF0CHEADER\u4E3AHTTP\u8BF7\u6C42\u4E2D\u7684\u5185\u5BB9\u8F6C\u4E3A\u5C0F\u5199\uFF0C-\u53D8\u4E3A_(\u7834\u6298\u53F7\u53D8\u4E3A\u4E0B\u5212\u7EBF)\uFF0C\u4F8B\u5982\uFF1A$http_user_agent(Uaer-Agent\u7684\u503C)</span><span style="color:#FF7B72;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">$sent_http_HEADER  HTTP\u54CD\u5E94\u5934\u4E2D\u7684\u5185\u5BB9\uFF0CHEADER\u4E3AHTTP\u54CD\u5E94\u4E2D\u7684\u5185\u5BB9\u8F6C\u4E3A\u5C0F\u5199\uFF0C-\u53D8\u4E3A_(\u7834\u6298\u53F7\u53D8\u4E3A\u4E0B\u5212\u7EBF)\uFF0C\u4F8B\u5982\uFF1A $sent_http_cache_control, $sent_http_content_type\u2026</span><span style="color:#FF7B72;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">$is_args  \u5982\u679C$args\u8BBE\u7F6E\uFF0C\u503C\u4E3A</span><span style="color:#A5D6FF;">&quot;?&quot;</span><span style="color:#C9D1D9;">\uFF0C\u5426\u5219\u4E3A</span><span style="color:#A5D6FF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">$limit_rate  \u8FD9\u4E2A\u53D8\u91CF\u53EF\u4EE5\u9650\u5236\u8FDE\u63A5\u901F\u7387\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$nginx_version\u5F53\u524D\u8FD0\u884C\u7684nginx\u7248\u672C\u53F7</span></span>
<span class="line"><span style="color:#C9D1D9;">$query_string  \u4E0E$args\u76F8\u540C</span></span>
<span class="line"><span style="color:#C9D1D9;">$remote_addr\u5BA2\u6237\u7AEF\u7684IP\u5730\u5740\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$remote_port  \u5BA2\u6237\u7AEF\u7684\u7AEF\u53E3\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$remote_user   \u5DF2\u7ECF\u7ECF\u8FC7Auth Basic Module\u9A8C\u8BC1\u7684\u7528\u6237\u540D</span></span>
<span class="line"><span style="color:#C9D1D9;">$request_filename  \u5F53\u524D\u8FDE\u63A5\u8BF7\u6C42\u7684\u6587\u4EF6\u8DEF\u5F84\uFF0C\u7531root\u6216alias\u6307\u4EE4\u4E0EURI\u8BF7\u6C42\u751F\u6210</span></span>
<span class="line"><span style="color:#C9D1D9;">$request_body\u8FD9\u4E2A\u53D8\u91CF\uFF080.7.58+\uFF09\u5305\u542B\u8BF7\u6C42\u7684\u4E3B\u8981\u4FE1\u606F\u3002\u5728\u4F7F\u7528proxy_pass\u6216fastcgi_pass\u6307\u4EE4\u7684location\u4E2D\u6BD4\u8F83\u6709\u610F\u4E49</span></span>
<span class="line"><span style="color:#C9D1D9;">$request_body_file\u5BA2\u6237\u7AEF\u8BF7\u6C42\u4E3B\u4F53\u4FE1\u606F\u7684\u4E34\u65F6\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#C9D1D9;">$request_completion   \u5982\u679C\u8BF7\u6C42\u6210\u529F\uFF0C\u8BBE\u4E3A</span><span style="color:#A5D6FF;">&quot;OK&quot;</span><span style="color:#C9D1D9;">\uFF1B\u5982\u679C\u8BF7\u6C42\u672A\u5B8C\u6210\u6216\u8005\u4E0D\u662F\u4E00\u7CFB\u5217\u8BF7\u6C42\u4E2D\u6700\u540E\u4E00\u90E8\u5206\u5219\u8BBE\u4E3A\u7A7A\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$request_method  \u8FD9\u4E2A\u53D8\u91CF\u662F\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u52A8\u4F5C\uFF0C\u901A\u5E38\u4E3AGET\u6216POST\u3002\u5305\u62EC0.8.20\u53CA\u4E4B\u524D\u7684\u7248\u672C\u4E2D\uFF0C\u8FD9\u4E2A\u53D8\u91CF\u603B\u4E3Amain request\u4E2D\u7684\u52A8\u4F5C\uFF0C\u5982\u679C\u5F53\u524D\u8BF7\u6C42\u662F\u4E00\u4E2A\u5B50\u8BF7\u6C42\uFF0C\u5E76\u4E0D\u4F7F\u7528\u8FD9\u4E2A\u5F53\u524D\u8BF7\u6C42\u7684\u52A8\u4F5C\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$request_uri  \u8FD9\u4E2A\u53D8\u91CF\u7B49\u4E8E\u5305\u542B\u4E00\u4E9B\u5BA2\u6237\u7AEF\u8BF7\u6C42\u53C2\u6570\u7684\u539F\u59CBURI\uFF0C\u5B83\u65E0\u6CD5\u4FEE\u6539\uFF0C\u8BF7\u67E5\u770B$uri\u66F4\u6539\u6216\u91CD\u5199URI\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$scheme\u6240\u7528\u7684\u534F\u8BAE\uFF0C\u6BD4\u5982http\u6216\u8005\u662Fhttps\uFF0C\u6BD4\u5982rewrite ^(.+)$ $scheme://example.com$1 redirect</span><span style="color:#FF7B72;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">$server_addr\u670D\u52A1\u5668\u5730\u5740\uFF0C\u5728\u5B8C\u6210\u4E00\u6B21\u7CFB\u7EDF\u8C03\u7528\u540E\u53EF\u4EE5\u786E\u5B9A\u8FD9\u4E2A\u503C\uFF0C\u5982\u679C\u8981\u7ED5\u5F00\u7CFB\u7EDF\u8C03\u7528\uFF0C\u5219\u5FC5\u987B\u5728listen\u4E2D\u6307\u5B9A\u5730\u5740\u5E76\u4E14\u4F7F\u7528bind\u53C2\u6570\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$server_name  \u670D\u52A1\u5668\u540D\u79F0</span></span>
<span class="line"><span style="color:#C9D1D9;">$server_port\u8BF7\u6C42\u5230\u8FBE\u670D\u52A1\u5668\u7684\u7AEF\u53E3\u53F7</span></span>
<span class="line"><span style="color:#C9D1D9;">$server_protocol  \u8BF7\u6C42\u4F7F\u7528\u7684\u534F\u8BAE\uFF0C\u901A\u5E38\u662FHTTP/1.0\u6216HTTP/1.1\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">$uri  \u8BF7\u6C42\u4E2D\u7684\u5F53\u524DURI(\u4E0D\u5E26\u8BF7\u6C42\u53C2\u6570\uFF0C\u53C2\u6570\u4F4D\u4E8Eargs\uFF0C\u4E0D\u540C\u4E8E\u6D4F\u89C8\u5668\u4F20\u9012\u7684args)\uFF0C\u4E0D\u540C\u4E8E\u6D4F\u89C8\u5668\u4F20\u9012\u7684request_uri\u7684\u503C\uFF0C\u5B83\u53EF\u4EE5\u901A\u8FC7\u5185\u90E8\u91CD\u5B9A\u5411\uFF0C\u6216\u8005\u4F7F\u7528index\u6307\u4EE4\u8FDB\u884C\u4FEE\u6539\u3002\u4E0D\u5305\u62EC\u534F\u8BAE\u548C\u4E3B\u673A\u540D\uFF0C\u4F8B\u5982/foo/bar.html</span></span>
<span class="line"></span></code></pre></div><p>\u5173\u4E8E <code>$http_origin</code></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">$http_origin\u5E76\u4E0D\u662Fnginx\u7684\u5185\u7F6E\u53C2\u6570\uFF0Cnginx\u652F\u6301\u53D6\u81EA\u5B9A\u4E49\u7684\u53C2\u6570\u503C\uFF0C$http_XXX\u8FD9\u4E2A\u683C\u5F0F\u662Fnginx\u53D6\u8BF7\u6C42\u4E2Dheader\u7684XXX\u7684\u503C\u7684\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">\u8FD9\u91CC\u53D6\u7684\u662Forigin,\u800C\u4E00\u822C\u8DE8\u57DF\u8BF7\u6C42\u90FD\u4F1A\u5C06\u8BF7\u6C42\u7684\u6765\u6E90\u653E\u5728origin\u4E2D\uFF08\u6D4F\u89C8\u5668\u4F1A\u5F80\u8DE8\u57DF\u8BF7\u6C42\u7684header\u4E0A\u9762\u52A0origin\u8FD9\u4E2Aheader\uFF09\u3002</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A5D6FF;">\`\`\`</span></span>
<span class="line"><span style="color:#A5D6FF;">request headers:</span></span>
<span class="line"><span style="color:#A5D6FF;">-------------------------------</span></span>
<span class="line"><span style="color:#A5D6FF;">Accept: */*</span></span>
<span class="line"><span style="color:#A5D6FF;">Accept-Encoding: gzip, deflate</span></span>
<span class="line"><span style="color:#A5D6FF;">Accept-Language: zh-CN,zh;q=0.9</span></span>
<span class="line"><span style="color:#A5D6FF;">Connection: keep-alive</span></span>
<span class="line"><span style="color:#A5D6FF;">Host: 61.231.19.187:8089</span></span>
<span class="line"><span style="color:#A5D6FF;">If-Modified-Since: Sun, 16 Aug 2020 08:22:11 GMT</span></span>
<span class="line"><span style="color:#A5D6FF;">If-None-Match: &quot;5f38ecb3-159&quot;</span></span>
<span class="line"><span style="color:#A5D6FF;">Origin: http://abc.bdc.cn:8080</span></span>
<span class="line"><span style="color:#A5D6FF;">Referer: http://abc.bdc.cn:8080/1/tmp/index.html</span></span>
<span class="line"><span style="color:#A5D6FF;">User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36</span></span>
<span class="line"><span style="color:#A5D6FF;">\`\`\`</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="\u4E00\u4E2A\u793A\u4F8B" tabindex="-1">\u4E00\u4E2A\u793A\u4F8B <a class="header-anchor" href="#\u4E00\u4E2A\u793A\u4F8B" aria-hidden="true">#</a></h3><p>\u4F7F\u7528 nginx \u90E8\u7F72\u9759\u6001\u7F51\u9875\uFF1A</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">80;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;">101.200.146.230; </span><span style="color:#8B949E;"># \u6307\u5B9AIP\u6216\u57DF\u540D</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/www/client/daotin; </span><span style="color:#8B949E;"># \u9759\u6001\u6587\u4EF6\u5B58\u653E\u5728/www/client/daotin\u76EE\u5F55\u4E0B</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.html;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="server-\u865A\u62DF\u4E3B\u673A\u914D\u7F6E" tabindex="-1">server \u865A\u62DF\u4E3B\u673A\u914D\u7F6E <a class="header-anchor" href="#server-\u865A\u62DF\u4E3B\u673A\u914D\u7F6E" aria-hidden="true">#</a></h3><p>\u57FA\u4E8E\u7AEF\u53E3\u53F7\u6765\u914D\u7F6E\u865A\u62DF\u4E3B\u673A\uFF0C\u7B97\u662F Nginx \u4E2D\u6700\u7B80\u5355\u7684\u4E00\u79CD\u65B9\u5F0F\u4E86\u3002\u539F\u7406\u5C31\u662F Nginx \u76D1\u542C\u591A\u4E2A\u7AEF\u53E3\uFF0C\u6839\u636E\u4E0D\u540C\u7684\u7AEF\u53E3\u53F7\uFF0C\u6765\u533A\u5206\u4E0D\u540C\u7684\u7F51\u7AD9\u3002</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">server{</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">8001;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;">localhost;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/usr/share/nginx/html/html8001;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.html;</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u91CD\u542F nginx\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u5728\u6D4F\u89C8\u5668\u4E2D\u8BBF\u95EE <code>http://localhost:8001</code>\u4E86\u3002</p><h3 id="\u7F13\u5B58\u914D\u7F6E" tabindex="-1">\u7F13\u5B58\u914D\u7F6E <a class="header-anchor" href="#\u7F13\u5B58\u914D\u7F6E" aria-hidden="true">#</a></h3><p>\u7F13\u5B58\u5BF9\u4E8E Web \u81F3\u5173\u91CD\u8981\uFF0C\u5C24\u5176\u5BF9\u4E8E\u5927\u578B\u9AD8\u8D1F\u8F7D Web \u7AD9\u70B9\u3002Nginx \u7F13\u5B58\u53EF\u4F5C\u4E3A\u6027\u80FD\u4F18\u5316\u7684\u4E00\u4E2A\u91CD\u8981\u624B\u6BB5\uFF0C\u53EF\u4EE5\u6781\u5927\u51CF\u8F7B\u540E\u7AEF\u670D\u52A1\u5668\u7684\u8D1F\u8F7D\u3002\u901A\u5E38\u5BF9\u4E8E\u9759\u6001\u8D44\u6E90\uFF0C\u5373\u8F83\u5C11\u7ECF\u5E38\u66F4\u65B0\u7684\u8D44\u6E90\uFF0C\u5982\u56FE\u7247\uFF0Ccss \u6216 js \u7B49\u8FDB\u884C\u7F13\u5B58\uFF0C\u4ECE\u800C\u5728\u6BCF\u6B21\u5237\u65B0\u6D4F\u89C8\u5668\u7684\u65F6\u5019\uFF0C\u4E0D\u7528\u91CD\u65B0\u8BF7\u6C42\uFF0C\u800C\u662F\u4ECE\u7F13\u5B58\u91CC\u9762\u8BFB\u53D6\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u51CF\u8F7B\u670D\u52A1\u5668\u7684\u538B\u529B\u3002</p><p>Nginx \u7F13\u5B58\u7C7B\u578B\uFF1A</p><p><img src="`+o+`" alt=""></p><p>Nginx \u8BBE\u7F6E\u7F13\u5B58\u6709\u4E24\u79CD\u65B9\u5F0F\uFF1A</p><ul><li><code>proxy_cache_path</code> \u548C <code>proxy_cache</code></li><li><code>Cache-Control</code> \u548C <code>Pragma</code></li></ul><p><strong>\u4E00\u822C\u6765\u8BF4\uFF0C\u7531\u670D\u52A1\u5668\u8BBE\u7F6E\u7F13\u5B58\u5373\u53EF\uFF0Cnginx \u4EE3\u7406\u7F13\u5B58\u53EF\u4EE5\u4E0D\u8BBE\u7F6E\u3002</strong></p><blockquote><p>\u53C2\u8003\uFF1A<a href="https://www.cnblogs.com/itzgr/p/13321980.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/itzgr/p/13321980.html</a></p></blockquote><h3 id="\u8DE8\u57DF\u914D\u7F6E" tabindex="-1">\u8DE8\u57DF\u914D\u7F6E <a class="header-anchor" href="#\u8DE8\u57DF\u914D\u7F6E" aria-hidden="true">#</a></h3><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">script</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> myHeaders </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">new</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">Headers</span><span style="color:#C9D1D9;">({</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">&quot;Access-Control-Allow-Origin&quot;</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;*&quot;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">&quot;Content-Type&quot;</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;application/json&quot;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">fetch</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;http://101.200.146.230:4444/test.json&quot;</span><span style="color:#C9D1D9;">, {</span></span>
<span class="line"><span style="color:#C9D1D9;">    method: </span><span style="color:#A5D6FF;">&quot;GET&quot;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    headers: myHeaders,</span></span>
<span class="line"><span style="color:#C9D1D9;">    mode: </span><span style="color:#A5D6FF;">&quot;cors&quot;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  })</span></span>
<span class="line"><span style="color:#C9D1D9;">    .</span><span style="color:#D2A8FF;">then</span><span style="color:#C9D1D9;">((</span><span style="color:#FFA657;">response</span><span style="color:#C9D1D9;">) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      console.</span><span style="color:#D2A8FF;">log</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;response.json==&gt;&quot;</span><span style="color:#C9D1D9;">, response.</span><span style="color:#D2A8FF;">json</span><span style="color:#C9D1D9;">());</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> response.</span><span style="color:#D2A8FF;">json</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    })</span></span>
<span class="line"><span style="color:#C9D1D9;">    .</span><span style="color:#D2A8FF;">then</span><span style="color:#C9D1D9;">((</span><span style="color:#FFA657;">data</span><span style="color:#C9D1D9;">) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> console.</span><span style="color:#D2A8FF;">log</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;test.json ==&gt;&quot;</span><span style="color:#C9D1D9;">, data))</span></span>
<span class="line"><span style="color:#C9D1D9;">    .</span><span style="color:#D2A8FF;">catch</span><span style="color:#C9D1D9;">((</span><span style="color:#FFA657;">err</span><span style="color:#C9D1D9;">) </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> console.</span><span style="color:#D2A8FF;">log</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;fetch\u5931\u8D25&quot;</span><span style="color:#C9D1D9;">, err));</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;/</span><span style="color:#7EE787;">script</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre></div><p><img src="`+e+`" alt="img"></p><h4 id="preflight-request-\u9884\u68C0\u8BF7\u6C42" tabindex="-1">preflight request \u9884\u68C0\u8BF7\u6C42 <a class="header-anchor" href="#preflight-request-\u9884\u68C0\u8BF7\u6C42" aria-hidden="true">#</a></h4><p>\u5BA2\u6237\u7AEF\u4EC5\u53D1\u9001\u4E86\u4E00\u4E2A OPTIONS \u65B9\u6CD5\u7684\u8BF7\u6C42\uFF0C\u88AB\u670D\u52A1\u5668 403 \u72B6\u6001\u7801\u7ED9\u62D2\u7EDD\u4E86\uFF0C\u67E5\u9605\u4E86\u6709\u5173 OPTIONS \u65B9\u6CD5\u548C\u9884\u68C0\u8BF7\u6C42\u7684\u535A\u5BA2\u548C\u6587\u6863\uFF0C\u68B3\u7406\u4E86\u5927\u6982\u5173\u7CFB\u3002</p><p><strong>\u4EC0\u4E48\u662F\u9884\u68C0\u8BF7\u6C42\uFF1F</strong></p><ol><li>HTTP \u8BF7\u6C42\u5206\u4E3A\u7B80\u5355\u8BF7\u6C42 \u4E0E \u590D\u6742\u8BF7\u6C42\uFF0C\u4E24\u79CD\u8BF7\u6C42\u7684\u533A\u522B\u4E3B\u8981\u5728\u4E8E\u7B80\u5355\u8BF7\u6C42\u4E0D\u4F1A\u89E6\u53D1 CORS \u9884\u68C0\u8BF7\u6C42\uFF0C\u800C\u590D\u6742\u8BF7\u6C42\u4F1A\u89E6\u53D1 CORS \u9884\u68C0\u8BF7\u6C42</li><li>\u6EE1\u8DB3\u7B80\u5355\u8BF7\u6C42\u7684\u6761\u4EF6(\u4E24\u4E2A\u6761\u4EF6\u9700\u8981\u90FD\u6EE1\u8DB3) <ul><li>\u65B9\u6CD5\u4E3A GET\u3001HEAD\u3001POST \u4E4B\u4E00</li><li>\u65E0\u81EA\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF0C\u4E14 Content-Type \u4E3A text/plain, mutipart/form-data application/x-www-form-urlencoded \u4E4B\u4E00</li></ul></li><li>\u4E0D\u6EE1\u8DB3\u7B80\u5355\u8BF7\u6C42\u7684\u4E00\u5207\u8BF7\u6C42\u90FD\u662F\u590D\u6742\u8BF7\u6C42</li><li>\u9884\u68C0\u8BF7\u6C42(\u4E00\u822C\u662F\u6D4F\u89C8\u5668\u81EA\u52A8\u53D1\u8D77\u7684 OPTIONS \u65B9\u6CD5\u7684\u8BF7\u6C42) \u4E2D <ul><li>Access-Control-Request-Method \u5B57\u6BB5\u544A\u8BC9\u670D\u52A1\u5668\u5B9E\u9645\u8BF7\u6C42\u4F1A\u4F7F\u7528\u7684 HTTP \u65B9\u6CD5\uFF1B</li><li>Access-Control-Request-Headers \u5B57\u6BB5\u544A\u77E5\u670D\u52A1\u5668\u5B9E\u9645\u60C5\u51B5\u6240\u643A\u5E26\u7684\u81EA\u5B9A\u4E49\u9996\u90E8\u5B57\u6BB5\u3002\u670D\u52A1\u5668\u57FA\u4E8E\u9884\u68C0\u8BF7\u6C42\u83B7\u5F97\u7684\u4FE1\u606F\u6765\u5224\u65AD\uFF0C\u662F\u5426\u63A5\u53D7\u63A5\u4E0B\u6765\u7684\u5B9E\u9645\u8BF7\u6C42\u3002\u670D\u52A1\u5668\u7AEF\u8FD4\u56DE\u7684 Access-Control-Allow-Methods \u5B57\u6BB5 \u5C06\u670D\u52A1\u5668\u5141\u8BB8\u7684\u8BF7\u6C42\u65B9\u6CD5\u544A\u8BC9\u5BA2\u6237\u7AEF\u3002\u8BE5\u9996\u90E8\u5B57\u6BB5\u4E0E Allow \u7C7B\u4F3C\uFF0C\u4F46\u53EA\u80FD\u7528\u6237\u8BBE\u8BA1\u5230 CORS \u7684\u573A\u666F\u4E2D\u3002</li></ul></li></ol><div class="info custom-block"><p class="custom-block-title">\u{1F4A1} \u4E3A\u4EC0\u4E48\u8981\u53D1\u8D77\u9884\u68C0\u8BF7\u6C42 \uFF1F</p><p><a href="https://blog.csdn.net/mym940725/article/details/79506994" title="\u300A\u5173\u4E8Epreflight request\u300B" target="_blank" rel="noreferrer">\u300A\u5173\u4E8E preflight request\u300B</a> \u89E3\u91CA\u7684\u6BD4\u8F83\u6E05\u695A\uFF0C\u76EE\u524D\u6D4F\u89C8\u5668\u9650\u5236\u8DE8\u57DF\u7684\u65B9\u5F0F\u4E3B\u8981\u6709\u4E24\u79CD</p><ol><li>\u6D4F\u89C8\u5668\u9650\u5236\u53D1\u8D77\u8DE8\u57DF\u8BF7\u6C42</li><li>\u8DE8\u57DF\u8BF7\u6C42\u53EF\u4EE5\u6B63\u5E38\u53D1\u8D77\uFF0C\u4F46\u662F\u8FD4\u56DE\u7684\u7ED3\u679C\u88AB\u6D4F\u89C8\u5668\u62E6\u622A</li></ol><p>\u4E00\u822C\u6D4F\u89C8\u5668\u90FD\u662F\u91C7\u7528\u7B2C\u4E8C\u79CD\u65B9\u5F0F\u9650\u5236\u8DE8\u57DF\u8BF7\u6C42\uFF0C\u4E5F\u5C31\u662F\u8BF4\u8BF7\u6C42\u5DF2\u7ECF\u5230\u8FBE\u4E86\u670D\u52A1\u5668\uFF0C\u5982\u679C\u662F\u590D\u6742\u8BF7\u6C42\uFF0C\u5BF9\u670D\u52A1\u5668\u6570\u636E\u5E93\u7684\u6570\u636E\u8FDB\u884C\u4E86\u64CD\u4F5C\uFF0C\u4F46\u8FD4\u56DE\u7ED9\u6D4F\u89C8\u5668\u7684\u7ED3\u679C\u5374\u88AB\u62E6\u622A\uFF0C\u88AB\u8BC6\u522B\u4E3A\u4E00\u6B21\u5931\u8D25\u7684\u8BF7\u6C42\uFF0C\u8FD9\u65F6\u5019\u53EF\u80FD\u5BF9\u6570\u636E\u5E93\u91CC\u6570\u636E\u5DF2\u7ECF\u4EA7\u751F\u4E86\u5F71\u54CD\u3002\u4E3A\u4E86\u9632\u6B62\u8FD9\u79CD\u60C5\u51B5\u53D1\u751F\uFF0C\u8FD9\u79CD\u53EF\u80FD\u5BF9\u670D\u52A1\u5668\u6570\u636E\u4EA7\u751F\u64CD\u4F5C\u7684 HTTP \u8BF7\u6C42\uFF0C\u6D4F\u89C8\u5668\u5FC5\u987B\u5148\u8BD5\u7528 OPTIONS \u65B9\u6CD5\u53D1\u8D77\u9884\u68C0\u8BF7\u6C42\uFF0C\u4ECE\u800C\u83B7\u77E5\u670D\u52A1\u5668\u662F\u5426\u5141\u8BB8\u8BE5\u8DE8\u57DF\u8BF7\u6C42\u3002</p><p>\u53C2\u8003\u8D44\u6599\uFF1A</p><ul><li><a href="https://blog.csdn.net/zimuKobby/article/details/108389410" title="https://blog.csdn.net/zimuKobby/article/details/108389410" target="_blank" rel="noreferrer">https://blog.csdn.net/zimuKobby/article/details/108389410</a></li><li><a href="https://www.imqianduan.com/nginx/preflight-options.html" target="_blank" rel="noreferrer">nginx \u4F18\u5316\u8DE8\u57DF\u7684 OPTIONS \u8BF7\u6C42</a></li></ul></div><h4 id="\u5982\u4F55\u914D\u7F6E\u8DE8\u57DF" tabindex="-1">\u5982\u4F55\u914D\u7F6E\u8DE8\u57DF <a class="header-anchor" href="#\u5982\u4F55\u914D\u7F6E\u8DE8\u57DF" aria-hidden="true">#</a></h4><blockquote><p><strong>\u6CE8\u610F\uFF1A\u5982\u679C\u662F A \u8BBF\u95EE B \u51FA\u73B0\u8DE8\u57DF\uFF0C\u5219\u9700\u8981\u5728 B \u4E0A\u8FDB\u884C\u8DE8\u57DF\u8BBE\u7F6E\uFF0C\u800C\u4E0D\u662F\u5728 A \u4E0A\u3002</strong></p></blockquote><p>\u6BD4\u5982 A \u7684\u5730\u5740\u662F <code>101.200.146.230:80</code>\uFF0C\u7136\u540E\u8BBF\u95EE B \u7684\u5730\u5740 <code>101.200.146.230:4444</code> \u4E2D\u7684\u4E00\u4E2A <code>test.json</code>\u6587\u4EF6\uFF0C\u56E0\u4E3A\u7AEF\u53E3\u4E0D\u540C\uFF0C\u6240\u4EE5\u4F1A\u62A5\u8DE8\u57DF\u9519\u8BEF\u3002</p><p>\u9700\u8981\u5728 B \u670D\u52A1\u8BBE\u7F6E\u8DE8\u57DF\uFF1A</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">4444;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;">101.200.146.230;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># \u53C2\u8003\u65B9\u6848:https://segmentfault.com/q/1010000021055878</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> add_header </span><span style="color:#A5D6FF;">&quot;Access-Control-Allow-Origin&quot;</span><span style="color:#C9D1D9;"> $http_origin;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">#   \u5E26cookie\u8BF7\u6C42\u9700\u8981\u52A0\u4E0A\u8FD9\u4E2A\u5B57\u6BB5\uFF0C\u5E76\u8BBE\u7F6E\u4E3Atrue</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> add_header </span><span style="color:#C9D1D9;">Access-Control-Allow-Credentials</span><span style="color:#79C0FF;"> true</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># $http_origin\u52A8\u6001\u83B7\u53D6\u8BF7\u6C42\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u57DF   \u4E0D\u7528*\u7684\u539F\u56E0\u662F\u5E26cookie\u7684\u8BF7\u6C42\u4E0D\u652F\u6301*\u53F7</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># add_header &quot;Access-Control-Allow-Origin&quot; $http_origin; # \u5F53\u524D\u8BF7\u6C42\u57DF\u540D\uFF0C\u4E0D\u652F\u6301\u643A\u5E26Cookie\u7684\u8BF7\u6C42</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> add_header </span><span style="color:#A5D6FF;">&quot;Access-Control-Allow-Methods&quot;</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&quot;GET, POST, OPTIONS&quot;</span><span style="color:#C9D1D9;">; </span><span style="color:#8B949E;"># \u5141\u8BB8\u7684\u8BF7\u6C42\u65B9\u5F0F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">#   \u8868\u793A\u8BF7\u6C42\u5934\u7684\u5B57\u6BB5 \u52A8\u6001\u83B7\u53D6</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> add_header </span><span style="color:#C9D1D9;">Access-Control-Allow-Headers $http_access_control_request_headers;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># \u9632\u6B62\u62A5preflight request\u9519\u8BEF</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($request_method </span><span style="color:#FF7B72;">= </span><span style="color:#A5D6FF;">&quot;OPTIONS&quot;</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">200</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/www/static; </span><span style="color:#8B949E;">#\u8D44\u6E90\u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.html;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p><strong>\u9664\u4E86\u8BBF\u95EE\u522B\u4EBA\u670D\u52A1\u5668\u4E0A\u7684\u6587\u4EF6\u662F\u8DE8\u57DF\u5916\uFF0C\u63A5\u53E3\u8BBF\u95EE\u4E5F\u662F\u8DE8\u57DF\u3002\u56E0\u4E3A\u63A5\u53E3\u4E5F\u662F\u6587\u4EF6\uFF0C\u63A5\u53E3\u5B9E\u9645\u4E0A\u8DDF\u670D\u52A1\u5668\u4E0A\u7684\u6587\u4EF6\u662F\u6709\u4E00\u4E2A\u6620\u5C04\u5173\u7CFB\u7684\uFF0C\u56E0\u6B64\uFF0C\u63A5\u53E3\u4E5F\u53EF\u4EE5\u4F7F\u7528 nginx \u6765\u8FDB\u884C\u8DE8\u57DF\u914D\u7F6E\u3002</strong></p><h3 id="\u53CD\u5411\u4EE3\u7406" tabindex="-1">\u53CD\u5411\u4EE3\u7406 <a class="header-anchor" href="#\u53CD\u5411\u4EE3\u7406" aria-hidden="true">#</a></h3><p><strong>\u4EC0\u4E48\u662F\u53CD\u5411\u4EE3\u7406\uFF1F</strong></p><p>\u53CD\u5411\u4EE3\u7406\uFF08Reverse Proxy\uFF09\u65B9\u5F0F\u662F\u6307\u4EE5\u4EE3\u7406\u670D\u52A1\u5668\u6765\u63A5\u53D7 internet \u4E0A\u7684\u8FDE\u63A5\u8BF7\u6C42\uFF0C\u7136\u540E\u5C06\u8BF7\u6C42\u8F6C\u53D1\u7ED9\u5185\u90E8\u7F51\u7EDC\u4E0A\u7684\u670D\u52A1\u5668\uFF0C\u5E76\u5C06\u4ECE\u670D\u52A1\u5668\u4E0A\u5F97\u5230\u7684\u7ED3\u679C\u8FD4\u56DE\u7ED9 internet \u4E0A\u8BF7\u6C42\u8FDE\u63A5\u7684\u5BA2\u6237\u7AEF\uFF0C\u6B64\u65F6\u4EE3\u7406\u670D\u52A1\u5668\u5BF9\u5916\u5C31\u8868\u73B0\u4E3A\u4E00\u4E2A\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\u3002</p><p><strong>\u6B63\u5411\u4EE3\u7406\uFF1A</strong> \u4E00\u822C\u7684\u8BBF\u95EE\u6D41\u7A0B\u662F\u5BA2\u6237\u7AEF\u76F4\u63A5\u5411\u76EE\u6807\u670D\u52A1\u5668\u53D1\u9001\u8BF7\u6C42\u5E76\u83B7\u53D6\u5185\u5BB9\uFF0C\u4F7F\u7528\u6B63\u5411\u4EE3\u7406\u540E\uFF0C\u5BA2\u6237\u7AEF\u6539\u4E3A\u5411\u4EE3\u7406\u670D\u52A1\u5668\u53D1\u9001\u8BF7\u6C42\uFF0C\u5E76\u6307\u5B9A\u76EE\u6807\u670D\u52A1\u5668\uFF08\u539F\u59CB\u670D\u52A1\u5668\uFF09\uFF0C\u7136\u540E\u7531\u4EE3\u7406\u670D\u52A1\u5668\u548C\u539F\u59CB\u670D\u52A1\u5668\u901A\u4FE1\uFF0C\u8F6C\u4EA4\u8BF7\u6C42\u5E76\u83B7\u5F97\u7684\u5185\u5BB9\uFF0C\u518D\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002\u6B63\u5411\u4EE3\u7406\u9690\u85CF\u4E86\u771F\u5B9E\u7684\u5BA2\u6237\u7AEF\uFF0C\u4E3A\u5BA2\u6237\u7AEF\u6536\u53D1\u8BF7\u6C42\uFF0C\u4F7F\u771F\u5B9E\u5BA2\u6237\u7AEF\u5BF9\u670D\u52A1\u5668\u4E0D\u53EF\u89C1\uFF1B</p><p>\u4E3E\u4E2A\u5177\u4F53\u7684\u4F8B\u5B50 \u{1F330}\uFF0C\u4F60\u7684\u6D4F\u89C8\u5668\u65E0\u6CD5\u76F4\u63A5\u8BBF\u95EE\u8C37\u54E5\uFF0C\u8FD9\u65F6\u5019\u53EF\u4EE5\u901A\u8FC7\u4E00\u4E2A\u4EE3\u7406\u670D\u52A1\u5668\u6765\u5E2E\u52A9\u4F60\u8BBF\u95EE\u8C37\u54E5\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u670D\u52A1\u5668\u5C31\u53EB\u6B63\u5411\u4EE3\u7406\u3002</p><p><img src="`+c+'" alt="1680416377724"></p><p><strong>\u53CD\u5411\u4EE3\u7406\uFF1A</strong> \u4E0E\u4E00\u822C\u8BBF\u95EE\u6D41\u7A0B\u76F8\u6BD4\uFF0C\u4F7F\u7528\u53CD\u5411\u4EE3\u7406\u540E\uFF0C\u76F4\u63A5\u6536\u5230\u8BF7\u6C42\u7684\u670D\u52A1\u5668\u662F\u4EE3\u7406\u670D\u52A1\u5668\uFF0C\u7136\u540E\u5C06\u8BF7\u6C42\u8F6C\u53D1\u7ED9\u5185\u90E8\u7F51\u7EDC\u4E0A\u771F\u6B63\u8FDB\u884C\u5904\u7406\u7684\u670D\u52A1\u5668\uFF0C\u5F97\u5230\u7684\u7ED3\u679C\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002\u53CD\u5411\u4EE3\u7406\u9690\u85CF\u4E86\u771F\u5B9E\u7684\u670D\u52A1\u5668\uFF0C\u4E3A\u670D\u52A1\u5668\u6536\u53D1\u8BF7\u6C42\uFF0C\u4F7F\u771F\u5B9E\u670D\u52A1\u5668\u5BF9\u5BA2\u6237\u7AEF\u4E0D\u53EF\u89C1\u3002\u4E00\u822C\u5728\u5904\u7406\u8DE8\u57DF\u8BF7\u6C42\u7684\u65F6\u5019\u6BD4\u8F83\u5E38\u7528\u3002\u73B0\u5728\u57FA\u672C\u4E0A\u6240\u6709\u7684\u5927\u578B\u7F51\u7AD9\u90FD\u8BBE\u7F6E\u4E86\u53CD\u5411\u4EE3\u7406\u3002</p><p>\u4E3E\u4E2A\u5177\u4F53\u7684\u4F8B\u5B50 \u{1F330}\uFF0C\u53BB\u996D\u5E97\u5403\u996D\uFF0C\u53EF\u4EE5\u70B9\u5DDD\u83DC\u3001\u7CA4\u83DC\u3001\u6C5F\u6D59\u83DC\uFF0C\u996D\u5E97\u4E5F\u5206\u522B\u6709\u4E09\u4E2A\u83DC\u7CFB\u7684\u53A8\u5E08 \u{1F468}\u200D\u{1F373}\uFF0C\u4F46\u662F\u4F60\u4F5C\u4E3A\u987E\u5BA2\u4E0D\u7528\u7BA1\u54EA\u4E2A\u53A8\u5E08\u7ED9\u4F60\u505A\u7684\u83DC\uFF0C\u53EA\u7528\u70B9\u83DC\u5373\u53EF\uFF0C\u5C0F\u4E8C\u5C06\u4F60\u83DC\u5355\u4E2D\u7684\u83DC\u5206\u914D\u7ED9\u4E0D\u540C\u7684\u53A8\u5E08\u6765\u5177\u4F53\u5904\u7406\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u5C0F\u4E8C\u5C31\u662F\u53CD\u5411\u4EE3\u7406\u670D\u52A1\u5668\u3002</p><p><img src="'+t+`" alt="1680416395702"></p><p>\u7B80\u5355\u7684\u8BF4\uFF0C\u4E00\u822C\u7ED9\u5BA2\u6237\u7AEF\u505A\u4EE3\u7406\u7684\u90FD\u662F\u6B63\u5411\u4EE3\u7406\uFF0C\u7ED9\u670D\u52A1\u5668\u505A\u4EE3\u7406\u7684\u5C31\u662F\u53CD\u5411\u4EE3\u7406\u3002</p><p>\u603B\u7ED3\uFF1A</p><p>\u6B63\u5411\u4EE3\u7406\u4E0E\u53CD\u5411\u4EE3\u7406\uFF1A<a href="https://juejin.cn/post/7095321237122990116" title="https://juejin.cn/post/7095321237122990116" target="_blank" rel="noreferrer">https://juejin.cn/post/7095321237122990116</a></p><p>\u6B63\u5411\u4EE3\u7406\u662F<strong>\u4EE3\u7406\u5BA2\u6237\u7AEF</strong>\uFF0C\u4E3A\u5BA2\u6237\u7AEF\u6536\u53D1\u8BF7\u6C42\uFF0C\u4F7F\u771F\u5B9E\u5BA2\u6237\u7AEF\u5BF9\u670D\u52A1\u5668\u4E0D\u53EF\u89C1\u3002</p><p>\u7528\u9014\uFF1A\u79D1\u5B66\u4E0A\u7F51\u3002</p><p>\u53CD\u5411\u4EE3\u7406\u662F<strong>\u4EE3\u7406\u670D\u52A1\u5668</strong>\uFF0C\u4E3A\u670D\u52A1\u5668\u6536\u53D1\u8BF7\u6C42\uFF0C\u4F7F\u771F\u5B9E\u670D\u52A1\u5668\u5BF9\u5BA2\u6237\u7AEF\u4E0D\u53EF\u89C1\u3002</p><p>\u7528\u9014\uFF1A\u8D1F\u8F7D\u5747\u8861\uFF0C\u63D0\u4F9B\u5B89\u5168\u4FDD\u969C\u3002</p><p>nginx \u53CD\u5411\u4EE3\u7406\u4E3B\u8981\u901A\u8FC7 <code>proxy_pass</code>\u6765\u914D\u7F6E\uFF0C\u5C06\u4F60\u9879\u76EE\u7684\u5F00\u53D1\u673A\u5730\u5740\u586B\u5199\u5230 proxy_pass \u540E\u9762\uFF0C\u6B63\u5E38\u7684\u683C\u5F0F\u4E3A proxy_pass URL \u5373\u53EF\u3002</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">80;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://10.10.10.10:20186;</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u53CD\u5411\u4EE3\u7406\u8FD8\u6709\u4E9B\u5E38\u7528\u7684\u6307\u4EE4\uFF0C\u6211\u5728\u8FD9\u91CC\u7ED9\u5927\u5BB6\u5217\u51FA\uFF1A</p><ul><li><code>proxy_set_header</code> :\u5728\u5C06\u5BA2\u6237\u7AEF\u8BF7\u6C42\u53D1\u9001\u7ED9\u540E\u7AEF\u670D\u52A1\u5668\u4E4B\u524D\uFF0C\u66F4\u6539\u6765\u81EA\u5BA2\u6237\u7AEF\u7684\u8BF7\u6C42\u5934\u4FE1\u606F\u3002</li><li><code>proxy_connect_timeout</code>:\u914D\u7F6E Nginx \u4E0E\u540E\u7AEF\u4EE3\u7406\u670D\u52A1\u5668\u5C1D\u8BD5\u5EFA\u7ACB\u8FDE\u63A5\u7684\u8D85\u65F6\u65F6\u95F4\u3002</li><li><code>proxy_read_timeout</code> : \u914D\u7F6E Nginx \u5411\u540E\u7AEF\u670D\u52A1\u5668\u7EC4\u53D1\u51FA read \u8BF7\u6C42\u540E\uFF0C\u7B49\u5F85\u76F8\u5E94\u7684\u8D85\u65F6\u65F6\u95F4\u3002</li><li><code>proxy_send_timeout</code>\uFF1A\u914D\u7F6E Nginx \u5411\u540E\u7AEF\u670D\u52A1\u5668\u7EC4\u53D1\u51FA write \u8BF7\u6C42\u540E\uFF0C\u7B49\u5F85\u76F8\u5E94\u7684\u8D85\u65F6\u65F6\u95F4\u3002</li><li><code>proxy_redirect</code> :\u7528\u4E8E\u4FEE\u6539\u540E\u7AEF\u670D\u52A1\u5668\u8FD4\u56DE\u7684\u54CD\u5E94\u5934\u4E2D\u7684 Location \u548C Refresh\u3002</li></ul><h3 id="\u8D1F\u8F7D\u5747\u8861" tabindex="-1">\u8D1F\u8F7D\u5747\u8861 <a class="header-anchor" href="#\u8D1F\u8F7D\u5747\u8861" aria-hidden="true">#</a></h3><p>\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u5BA2\u6237\u7AEF\u53D1\u9001\u591A\u4E2A\u8BF7\u6C42\u5230\u670D\u52A1\u5668\uFF0C\u670D\u52A1\u5668\u5904\u7406\u8BF7\u6C42\uFF0C\u5176\u4E2D\u4E00\u90E8\u5206\u53EF\u80FD\u8981\u64CD\u4F5C\u4E00\u4E9B\u8D44\u6E90\u6BD4\u5982\u6570\u636E\u5E93\u3001\u9759\u6001\u8D44\u6E90\u7B49\uFF0C\u670D\u52A1\u5668\u5904\u7406\u5B8C\u6BD5\u540E\uFF0C\u518D\u5C06\u7ED3\u679C\u8FD4\u56DE\u7ED9\u5BA2\u6237\u7AEF\u3002</p><p>\u8FD9\u79CD\u6A21\u5F0F\u5BF9\u4E8E\u65E9\u671F\u7684\u7CFB\u7EDF\u6765\u8BF4\uFF0C\u529F\u80FD\u8981\u6C42\u4E0D\u590D\u6742\uFF0C\u4E14\u5E76\u53D1\u8BF7\u6C42\u76F8\u5BF9\u8F83\u5C11\u7684\u60C5\u51B5\u4E0B\u8FD8\u80FD\u80DC\u4EFB\uFF0C\u6210\u672C\u4E5F\u4F4E\u3002\u968F\u7740\u4FE1\u606F\u6570\u91CF\u4E0D\u65AD\u589E\u957F\uFF0C\u8BBF\u95EE\u91CF\u548C\u6570\u636E\u91CF\u98DE\u901F\u589E\u957F\uFF0C\u4EE5\u53CA\u7CFB\u7EDF\u4E1A\u52A1\u590D\u6742\u5EA6\u6301\u7EED\u589E\u52A0\uFF0C\u8FD9\u79CD\u505A\u6CD5\u5DF2\u65E0\u6CD5\u6EE1\u8DB3\u8981\u6C42\uFF0C\u5E76\u53D1\u91CF\u7279\u522B\u5927\u65F6\uFF0C\u670D\u52A1\u5668\u5BB9\u6613\u5D29\u3002</p><p>\u5F88\u660E\u663E\u8FD9\u662F\u7531\u4E8E\u670D\u52A1\u5668\u6027\u80FD\u7684\u74F6\u9888\u9020\u6210\u7684\u95EE\u9898\uFF0C\u9664\u4E86\u5806\u673A\u5668\u4E4B\u5916\uFF0C\u6700\u91CD\u8981\u7684\u505A\u6CD5\u5C31\u662F\u8D1F\u8F7D\u5747\u8861\u3002</p><p>\u8BF7\u6C42\u7206\u53D1\u5F0F\u589E\u957F\u7684\u60C5\u51B5\u4E0B\uFF0C\u5355\u4E2A\u673A\u5668\u6027\u80FD\u518D\u5F3A\u52B2\u4E5F\u65E0\u6CD5\u6EE1\u8DB3\u8981\u6C42\u4E86\uFF0C\u8FD9\u4E2A\u65F6\u5019\u96C6\u7FA4\u7684\u6982\u5FF5\u4EA7\u751F\u4E86\uFF0C\u5355\u4E2A\u670D\u52A1\u5668\u89E3\u51B3\u4E0D\u4E86\u7684\u95EE\u9898\uFF0C\u53EF\u4EE5\u4F7F\u7528\u591A\u4E2A\u670D\u52A1\u5668\uFF0C\u7136\u540E\u5C06\u8BF7\u6C42\u5206\u53D1\u5230\u5404\u4E2A\u670D\u52A1\u5668\u4E0A\uFF0C\u5C06\u8D1F\u8F7D\u5206\u53D1\u5230\u4E0D\u540C\u7684\u670D\u52A1\u5668\uFF0C\u8FD9\u5C31\u662F <strong>\u8D1F\u8F7D\u5747\u8861</strong> \uFF0C\u6838\u5FC3\u662F\u300C\u5206\u644A\u538B\u529B\u300D\u3002</p><p><code>Nginx</code>\u63D0\u4F9B\u4EE5\u4E0B <code>\u8D1F\u8F7D\u5747\u8861</code>\u65B9\u5F0F\uFF0C\u9ED8\u8BA4\u4E3A <code>\u8F6E\u8BE2</code>\u3002</p><ul><li><strong>\u8F6E\u8BE2</strong>\uFF1A\u65E0\u9700\u914D\u7F6E\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u6839\u636E\u65F6\u95F4\u987A\u5E8F\u9010\u4E00\u5206\u914D\u5230\u4E0D\u540C\u670D\u52A1\u5668\uFF0C\u82E5\u5176\u4E2D\u4E00\u4E2A\u670D\u52A1\u6302\u4E86\u4F1A\u81EA\u52A8\u88AB\u5254\u9664</li><li><strong>weight</strong>\uFF1A\u6839\u636E\u6743\u91CD\u5206\u914D\uFF0C\u6307\u5B9A\u6BCF\u4E2A\u670D\u52A1\u5668\u7684\u8F6E\u8BE2\u51E0\u7387\uFF0C\u6743\u91CD\u8D8A\u9AD8\u5176\u88AB\u8BBF\u95EE\u7684\u6982\u7387\u8D8A\u5927\uFF0C\u53EF\u89E3\u51B3\u670D\u52A1\u5668\u6027\u80FD\u4E0D\u5747\u7684\u95EE\u9898</li><li><strong>ip_hash</strong>\uFF1A\u6839\u636E\u8BBF\u95EE <code>IP</code>\u7684 <code>Hash\u7ED3\u679C</code>\u5206\u914D\uFF0C\u6BCF\u4E2A\u8BBF\u5BA2\u56FA\u5B9A\u8BBF\u95EE\u4E00\u4E2A\u670D\u52A1\u5668\uFF0C\u53EF\u89E3\u51B3\u52A8\u6001\u7F51\u9875 <code>Session\u5171\u4EAB</code>\u7684\u95EE\u9898</li><li><strong>fair</strong>\uFF1A\u6839\u636E\u670D\u52A1\u5668\u54CD\u5E94\u65F6\u95F4\u5206\u914D\uFF0C\u54CD\u5E94\u65F6\u95F4\u77ED\u7684\u670D\u52A1\u5668\u4F1A\u4F18\u5148\u5206\u914D\uFF0C\u9700\u5B89\u88C5 <code>nginx-upstream-fair</code></li></ul><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">upstream</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">firstdemo </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># ip_hash; # IpHash\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># fair; # Fair\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> http://127.0.0.1:9999; </span><span style="color:#8B949E;"># \u8D1F\u8F7D\u5747\u8861\u76EE\u7684\u670D\u52A1\u5730\u5740\uFF1A\u53EF\u8BBE\u7F6E\u591A\u4E2A\u670D\u52A1\u5668</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> http://127.0.0.1:8888;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> http://127.0.0.1:7777 </span><span style="color:#FFA657;">weight</span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">10</span><span style="color:#C9D1D9;">; </span><span style="color:#8B949E;"># \u914D\u7F6E\u6743\u91CD\uFF1A\u4E0D\u914D\u7F6E\u9ED8\u8BA4\u4E3A1</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  server {</span></span>
<span class="line"><span style="color:#C9D1D9;">    location / {</span></span>
<span class="line"><span style="color:#C9D1D9;">      proxy_pass firstdemo;</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> proxy_connect_timeout </span><span style="color:#C9D1D9;">10;</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>\u4E0A\u9762\u914D\u7F6E\u5404\u4E2A\u670D\u52A1\u5668\u4E2D\u90FD\u6307\u660E\u4E86\u4F20\u8F93\u534F\u8BAE\u4E3A <code>http://</code>, \u4F46\u662F\u5982\u679C\u4E0A\u9762\u7684\u63A5\u53E3\u6CA1\u6709\u6307\u660E\u534F\u8BAE\u7684\u8BDD\uFF0C\u90A3\u4E48\u6211\u4EEC\u9700\u8981\u5728 proxy_pass \u4E0A\u52A0\u4E0A\u4E86\uFF0C<code>proxy_pass http://proxy_xxx</code> \u8FD9\u6837\u7684\uFF0C\u5982\u4E0B\u914D\u7F6E\u4EE3\u7801\uFF1A</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">upstream</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">firstdemo </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># ip_hash; # IpHash\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># fair; # Fair\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 127.0.0.1:9999; </span><span style="color:#8B949E;"># \u8D1F\u8F7D\u5747\u8861\u76EE\u7684\u670D\u52A1\u5730\u5740\uFF1A\u53EF\u8BBE\u7F6E\u591A\u4E2A\u670D\u52A1\u5668</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 127.0.0.1:8888;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 127.0.0.1:7777 </span><span style="color:#FFA657;">weight</span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">10</span><span style="color:#C9D1D9;">; </span><span style="color:#8B949E;"># \u914D\u7F6E\u6743\u91CD\uFF1A\u4E0D\u914D\u7F6E\u9ED8\u8BA4\u4E3A1</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  server {</span></span>
<span class="line"><span style="color:#C9D1D9;">    location / {</span></span>
<span class="line"><span style="color:#C9D1D9;">      proxy_pass http://firstdemo;</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> proxy_connect_timeout </span><span style="color:#C9D1D9;">10;</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="\u52A8\u9759\u5206\u79BB" tabindex="-1">\u52A8\u9759\u5206\u79BB <a class="header-anchor" href="#\u52A8\u9759\u5206\u79BB" aria-hidden="true">#</a></h3><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>\u52A8\u9759\u5206\u79BB\u5206\u79BB\u7684\u662F\u540E\u7AEF\u7684\u52A8\u6001\u8D44\u6E90\u548C\u9759\u6001\u8D44\u6E90\uFF0C\u800C\u4E0D\u662F\u524D\u7AEF\u7684\u8D44\u6E90\u3002\u524D\u7AEF\u7684\u90FD\u662F\u9759\u6001\u8D44\u6E90\u3002\u3002</p></div><p>\u52A8\u9759\u5206\u79BB\u5C31\u662F\u6839\u636E\u4E00\u5B9A\u89C4\u5219\u9759\u6001\u8D44\u6E90\u7684\u8BF7\u6C42\u5168\u90E8\u8BF7\u6C42 Nginx \u670D\u52A1\u5668\uFF0C\u540E\u53F0\u6570\u636E\u8BF7\u6C42\u8F6C\u53D1\u5230 Web \u5E94\u7528\u670D\u52A1\u5668\u4E0A\u3002\u4ECE\u800C\u8FBE\u5230\u52A8\u9759\u5206\u79BB\u7684\u76EE\u7684\u3002\u76EE\u524D\u6BD4\u8F83\u6D41\u884C\u7684\u505A\u6CD5\u662F\u5C06\u9759\u6001\u8D44\u6E90\u90E8\u7F72\u5728 Nginx \u4E0A\uFF0C\u800C Web \u5E94\u7528\u670D\u52A1\u5668\u53EA\u5904\u7406\u52A8\u6001\u6570\u636E\u8BF7\u6C42\u3002\u8FD9\u6837\u51CF\u5C11 Web \u5E94\u7528\u670D\u52A1\u5668\u7684\u5E76\u53D1\u538B\u529B\u3002</p><p>\u52A8\u9759\u5206\u79BB\uFF0C\u8BF4\u767D\u4E86\uFF0C\u5C31\u662F\u5C06\u7F51\u7AD9\u9759\u6001\u8D44\u6E90\uFF08HTML\uFF0CJavaScript\uFF0CCSS\uFF0Cimg \u7B49\u6587\u4EF6\uFF09\u4E0E\u540E\u53F0\u5E94\u7528\u5206\u5F00\u90E8\u7F72\uFF0C\u9759\u6001\u8D44\u6E90\u7684\u8BF7\u6C42\u5168\u90E8\u8BF7\u6C42 Nginx \u670D\u52A1\u5668\uFF0C\u540E\u53F0\u6570\u636E\u8BF7\u6C42\u8F6C\u53D1\u5230 Web \u5E94\u7528\u670D\u52A1\u5668\u4E0A\u3002\u63D0\u9AD8\u7528\u6237\u8BBF\u95EE\u9759\u6001\u4EE3\u7801\u7684\u901F\u5EA6\uFF0C\u964D\u4F4E\u5BF9\u540E\u53F0\u5E94\u7528\u670D\u52A1\u5668\u7684\u8BF7\u6C42\u3002\u540E\u53F0\u5E94\u7528\u670D\u52A1\u5668\u53EA\u8D1F\u8D23\u52A8\u6001\u6570\u636E\u8BF7\u6C42\u3002</p><p>\u52A8\u9759\u5206\u79BB\u53EF\u901A\u8FC7 location \u5BF9\u8BF7\u6C42 url \u8FDB\u884C\u5339\u914D\uFF0C\u5C06\u7F51\u7AD9\u9759\u6001\u8D44\u6E90\uFF08HTML\uFF0CJavaScript\uFF0CCSS\uFF0Cimg \u7B49\u6587\u4EF6\uFF09\u4E0E\u540E\u53F0\u5E94\u7528\u5206\u5F00\u90E8\u7F72\uFF0C\u63D0\u9AD8\u7528\u6237\u8BBF\u95EE\u9759\u6001\u4EE3\u7801\u7684\u901F\u5EA6\uFF0C\u964D\u4F4E\u5BF9\u540E\u53F0\u5E94\u7528\u8BBF\u95EE\u3002\u901A\u5E38\u5C06\u9759\u6001\u8D44\u6E90\u653E\u5230 nginx \u4E2D\uFF0C\u52A8\u6001\u8D44\u6E90\u8F6C\u53D1\u5230 tomcat \u670D\u52A1\u5668\u4E2D\u3002</p><p>\u76EE\u524D\u52A8\u9759\u5206\u79BB\u7684\u65B9\u5F0F\u6709\u4E24\u79CD\u89E3\u51B3\u65B9\u6848\u3002</p><ul><li>\u5C06\u9759\u6001\u8D44\u6E90\u5355\u72EC\u90E8\u7F72\u5230\u4E00\u4E2A\u57DF\u540D\u3002</li><li>\u5C06\u9759\u6001\u8D44\u6E90\u653E\u5728\u9879\u76EE\u4E4B\u5916\u7684\u67D0\u4E2A\u6587\u4EF6\u5939\uFF0C\u901A\u8FC7 <code>Nginx</code>\u914D\u7F6E\u533A\u5206\u3002\uFF08\u6BD4\u5982\u4E0A\u8FF0\u5728 <code>www</code>\u6587\u4EF6\u5939\u4E2D\u521B\u5EFA\u7684 <code>client</code>\u6587\u4EF6\u5939\u7528\u4E8E\u5B58\u653E <code>Web</code>\u5E94\u7528\u6E90\u7801\uFF0C\u521B\u5EFA\u7684 <code>static</code>\u6587\u4EF6\u5939\u7528\u4E8E\u5B58\u653E\u9759\u6001\u8D44\u6E90\u3002\uFF09</li></ul><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">80;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;">101.200.146.230; </span><span style="color:#8B949E;"># \u6307\u5B9AIP\u6216\u57DF\u540D</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/www/client/daotin;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.html;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># \u62E6\u622A\u9759\u6001\u8D44\u6E90</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">.*\\.(gif|jpg|jpeg|bmp|png|ico|txt)</span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">  /www/static;</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> expires </span><span style="color:#C9D1D9;">7d;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u793A\u4F8B\uFF1A</p><p>\u6BD4\u5982\u5F53\u6211\u4EEC\u4EE3\u7801\u4E2D\u8BBF\u95EE\u8D44\u6E90\u6587\u4EF6\u7684\u65F6\u5019\uFF0C\u5C31\u4F1A\u81EA\u52A8\u53BB <code>/www/static</code>\u76EE\u5F55\u5BFB\u627E\u5BF9\u5E94\u7684\u6587\u4EF6\u3002</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">el-image</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">src</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;/touxiang.jpg&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">el-image</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u5982\u679C\u662F\u4E0B\u9762\u7684\u5199\u6CD5</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">el-image</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">src</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;/static/touxiang.jpg&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">el-image</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u6211\u4EEC\u4F7F\u7528\u8DEF\u5F84\u5339\u914D\u4EE3\u7406\u5230 <code>/www/static</code> \u540E\uFF0C\u5B83\u5176\u5B9E\u8BBF\u95EE\u7684\u662F <code>/www/static/static/touxiang.jpg </code>\uFF0C\u800C\u4E0D\u662F <code>/www/static/touxiang.jpg</code>\uFF0C\u8FD9\u4E2A\u5343\u4E07\u8981\u6CE8\u610F\u4E86\u3002</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/static/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># \u8BBF\u95EE\u7684\u662F /www/static/static/touxiang.jpg</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/www/static;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># \u8BBF\u95EE\u7684\u662F /www/static/touxiang.jpg</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># alias /www/static/;</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u4E5F\u662F root \u548C alias \u7684\u533A\u522B\u3002</p><p>\u53C2\u8003\uFF1A</p><ul><li><a href="https://developer.aliyun.com/article/793181" target="_blank" rel="noreferrer">https://developer.aliyun.com/article/793181</a></li><li><a href="https://juejin.cn/post/7112826654291918855" target="_blank" rel="noreferrer">https://juejin.cn/post/7112826654291918855#heading-4</a></li></ul><h3 id="\u9002\u914D-pc-\u6216\u79FB\u52A8\u8BBE\u5907" tabindex="-1">\u9002\u914D PC \u6216\u79FB\u52A8\u8BBE\u5907 <a class="header-anchor" href="#\u9002\u914D-pc-\u6216\u79FB\u52A8\u8BBE\u5907" aria-hidden="true">#</a></h3><p>\u73B0\u5728\u5F88\u591A\u7F51\u7AD9\u90FD\u662F\u6709\u4E86 PC \u7AEF\u548C H5 \u7AD9\u70B9\u7684\uFF0C\u56E0\u4E3A\u8FD9\u6837\u5C31\u53EF\u4EE5\u6839\u636E\u5BA2\u6237\u8BBE\u5907\u7684\u4E0D\u540C\uFF0C\u663E\u793A\u51FA\u4F53\u9A8C\u66F4\u597D\u7684\uFF0C\u4E0D\u540C\u7684\u9875\u9762\u4E86\u3002</p><p>\u9664\u4E86\u81EA\u9002\u5E94\u4E4B\u5916\uFF0C\u5F88\u591A\u5927\u578B\u7F51\u7AD9\u4F7F\u7528\u5206\u5F00\u5236\u4F5C\u7684\u65B9\u5F0F\u6765\u5448\u73B0 PC \u548C H5 \u7AD9\u70B9\u5185\u5BB9\u3002</p><p>Nginx \u901A\u8FC7\u5185\u7F6E\u53D8\u91CF <code>$http_user_agent</code>\uFF0C\u53EF\u4EE5\u83B7\u53D6\u5230\u8BF7\u6C42\u5BA2\u6237\u7AEF\u7684 userAgent\uFF0C\u5C31\u53EF\u4EE5\u7528\u6237\u76EE\u524D\u5904\u4E8E\u79FB\u52A8\u7AEF\u8FD8\u662F PC \u7AEF\uFF0C\u8FDB\u800C\u5C55\u793A\u4E0D\u540C\u7684\u9875\u9762\u7ED9\u7528\u6237\u3002</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">server{</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">80;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;">localhost;</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($http_user_agent </span><span style="color:#FF7B72;">~* </span><span style="color:#A5D6FF;">&#39;(Android|iPhone|iPod)&#39;</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/usr/share/nginx/mobile;</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.html;</span></span>
<span class="line"><span style="color:#C9D1D9;">     }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7136\uFF0C\u5BF9\u4E8E\u5355\u9875\u9762\u5E94\u7528\uFF0C\u5165\u53E3\u90FD\u662F index.html\uFF0CPC \u548C\u79FB\u52A8\u7AEF\u4F1A\u4F7F\u7528\u7EC4\u4EF6\u6765\u533A\u5206\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u7528\u5230\u4E0A\u9762\u7684\u914D\u7F6E\u3002</p><h3 id="gzip-\u538B\u7F29" tabindex="-1">Gzip \u538B\u7F29 <a class="header-anchor" href="#gzip-\u538B\u7F29" aria-hidden="true">#</a></h3><p>\u9996\u5148\uFF0Cgzip \u662F\u9700\u8981\u670D\u52A1\u5668\u548C\u6D4F\u89C8\u5668\u540C\u65F6\u652F\u6301\u7684\u3002\u5F53\u6D4F\u89C8\u5668\u652F\u6301 gzip \u538B\u7F29\u65F6\uFF0C\u4F1A\u5728\u8BF7\u6C42\u6D88\u606F\u4E2D\u5305\u542B <code>Accept-Encoding: gzip</code>,\u8FD9\u6837 Nginx \u5C31\u4F1A\u5411\u6D4F\u89C8\u5668\u53D1\u9001\u7ECF\u8FC7 gzip \u540E\u7684\u5185\u5BB9\uFF0C\u540C\u65F6\u5728\u76F8\u5E94\u4FE1\u606F\u5934\u4E2D\u52A0\u5165 <code>Content-Encoding:gzip</code>\uFF0C\u58F0\u660E\u8FD9\u662F gzip \u540E\u7684\u5185\u5BB9\uFF0C\u544A\u77E5\u6D4F\u89C8\u5668\u8981\u5148\u89E3\u538B\u540E\u624D\u80FD\u89E3\u6790\u8F93\u51FA\u3002</p><p>Nginx \u63D0\u4F9B\u4E86\u4E13\u95E8\u7684 gzip \u6A21\u5757\uFF0C\u5E76\u4E14\u6A21\u5757\u4E2D\u7684\u6307\u4EE4\u975E\u5E38\u4E30\u5BCC\u3002</p><ul><li><code>gzip</code> : \u8BE5\u6307\u4EE4\u7528\u4E8E\u5F00\u542F\u6216 \u5173\u95ED gzip \u6A21\u5757\u3002</li><li><code>gzip_buffers</code> : \u8BBE\u7F6E\u7CFB\u7EDF\u83B7\u53D6\u51E0\u4E2A\u5355\u4F4D\u7684\u7F13\u5B58\u7528\u4E8E\u5B58\u50A8 gzip \u7684\u538B\u7F29\u7ED3\u679C\u6570\u636E\u6D41\u3002</li><li><code>gzip_comp_level</code> : gzip \u538B\u7F29\u6BD4\uFF0C\u538B\u7F29\u7EA7\u522B\u662F 1-9\uFF0C1 \u7684\u538B\u7F29\u7EA7\u522B\u6700\u4F4E\uFF0C9 \u7684\u538B\u7F29\u7EA7\u522B\u6700\u9AD8\u3002\u538B\u7F29\u7EA7\u522B\u8D8A\u9AD8\u538B\u7F29\u7387\u8D8A\u5927\uFF0C\u538B\u7F29\u65F6\u95F4\u8D8A\u957F\u3002</li><li><code>gzip_disable</code> : \u53EF\u4EE5\u901A\u8FC7\u8BE5\u6307\u4EE4\u5BF9\u4E00\u4E9B\u7279\u5B9A\u7684 User-Agent \u4E0D\u4F7F\u7528\u538B\u7F29\u529F\u80FD\u3002</li><li><code>gzip_min_length</code>:\u8BBE\u7F6E\u5141\u8BB8\u538B\u7F29\u7684\u9875\u9762\u6700\u5C0F\u5B57\u8282\u6570\uFF0C\u9875\u9762\u5B57\u8282\u6570\u4ECE\u76F8\u5E94\u6D88\u606F\u5934\u7684 Content-length \u4E2D\u8FDB\u884C\u83B7\u53D6\u3002</li><li><code>gzip_http_version</code>\uFF1A\u8BC6\u522B HTTP \u534F\u8BAE\u7248\u672C\uFF0C\u5176\u503C\u53EF\u4EE5\u662F 1.1.\u6216 1.0.</li><li><code>gzip_proxied</code> : \u7528\u4E8E\u8BBE\u7F6E\u542F\u7528\u6216\u7981\u7528\u4ECE\u4EE3\u7406\u670D\u52A1\u5668\u4E0A\u6536\u5230\u76F8\u5E94\u5185\u5BB9 gzip \u538B\u7F29\u3002</li><li><code>gzip_vary</code> : \u7528\u4E8E\u5728\u54CD\u5E94\u6D88\u606F\u5934\u4E2D\u6DFB\u52A0 Vary\uFF1AAccept-Encoding,\u4F7F\u4EE3\u7406\u670D\u52A1\u5668\u6839\u636E\u8BF7\u6C42\u5934\u4E2D\u7684 Accept-Encoding \u8BC6\u522B\u662F\u5426\u542F\u7528 gzip \u538B\u7F29\u3002</li></ul><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">   .....</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip </span><span style="color:#C9D1D9;">on;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># \u9700\u8981\u538B\u7F29\u7684\u7C7B\u578B</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_types </span><span style="color:#C9D1D9;">text/plain application/javascript text/css;</span></span>
<span class="line"><span style="color:#C9D1D9;">   .....</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><details class="details custom-block"><summary>\u2753 \u5982\u679C Nginx \u5DF2\u7ECF\u505A\u4E86 gzip\uFF0C\u90A3\u4E48 Vue \u8FD8\u9700\u8981\u505A\u5417\uFF1F</summary><p>1\u3001\u5176\u5B9E Vue \u672C\u8EAB\u4E0D\u80FD\u505A\u538B\u7F29\u6253\u5305\u4E4B\u7C7B\u7684\u529F\u80FD\uFF0C\u4ED6\u662F\u9760 webpack \u8FDB\u884C\u6253\u5305\uFF0C\u800C webpack \u6709\u63D2\u4EF6\u53EF\u4EE5\u751F\u4EA7 gz \u7C7B\u578B\u7684\u6587\u4EF6\u3002</p><p>2\u3001\u5F53\u4F60\u628A\u4E00\u4E2A\u5305\u542B gz \u7684\u9759\u6001\u8D44\u6E90\u653E\u5230 nginx \u4E0A\uFF0C\u6709 web \u8BF7\u6C42\u8FC7\u6765\u65F6\uFF0Cnginx \u5982\u679C\u5F00\u542F\u4E86 gzip\uFF0C\u90A3\u4E48\u5B83\u4F1A\u68C0\u6D4B\u4F60\u7684\u9759\u6001\u8D44\u6E90\u6587\u4EF6\u5939\u91CC\u9762\u6709\u6CA1\u6709 gz \u6587\u4EF6\uFF0C\u5982\u679C\u6709\u7684\u8BDD\uFF0Cnginx \u4F1A\u76F4\u63A5\u8FD4\u56DE gz \u6587\u4EF6\uFF0C\u5982\u679C\u6CA1\u6709\uFF0Cnginx \u4F1A\u52A8\u6001\u7684\u538B\u7F29\u6210 gz \u8FD4\u56DE\u5230\u6D4F\u89C8\u5668\u3002</p><p>\u56E0\u6B64\uFF0C\u5F53\u670D\u52A1\u5668\u914D\u7F6E\u4E86 gzip\uFF0C\u90A3\u4E48\u524D\u7AEF\u53EF\u4EE5\u4E0D\u7528\u505A gzip\uFF0C\u4F46\u662F\u4F60\u505A\u597D\u4E86 gz \u6587\u4EF6\u653E\u5230\u670D\u52A1\u5668\u4E0A\uFF0C \u53EF\u4EE5\u4E3A\u670D\u52A1\u5668\u7701\u4E0B\u5B9E\u65F6\u538B\u7F29\u6210 gz \u6587\u4EF6\u7684\u8BA1\u7B97\u8D44\u6E90\uFF0C\u6240\u4EE5\u63A8\u8350\u8FD8\u662F\u524D\u7AEF\u505A\u597D gzip \u7136\u540E\u653E\u5230\u670D\u52A1\u5668\u4E0A\u3002</p><blockquote><p>Tips\uFF1A nginx \u68C0\u6D4B gz \u6587\u4EF6\u9700\u8981\u624B\u52A8\u914D\u7F6E\u5F00\u542F\uFF0C\u4E5F\u53EF\u4EE5\u4E0D\u68C0\u6D4B\uFF0C\u6BCF\u6B21\u90FD\u5B9E\u65F6\u538B\u7F29\u4E3A gzip</p></blockquote></details><h3 id="nginx-\u9759\u6001\u538B\u7F29\u548C\u52A8\u6001\u538B\u7F29" tabindex="-1"><a href="https://www.cnblogs.com/hahaha111122222/p/16277891.html" target="_blank" rel="noreferrer">Nginx \u9759\u6001\u538B\u7F29\u548C\u52A8\u6001\u538B\u7F29</a> <a class="header-anchor" href="#nginx-\u9759\u6001\u538B\u7F29\u548C\u52A8\u6001\u538B\u7F29" aria-hidden="true">#</a></h3><p>Nginx \u4E2D\u914D\u7F6E\u524D\u7AEF\u7684 gzip \u538B\u7F29\uFF0C\u6709\u4E24\u79CD\u601D\u8DEF\uFF1A</p><ul><li>Nginx \u52A8\u6001\u538B\u7F29\uFF0C\u9759\u6001\u6587\u4EF6\u8FD8\u662F\u666E\u901A\u6587\u4EF6\uFF0C\u8BF7\u6C42\u6765\u4E86\u518D\u538B\u7F29\uFF0C\u7136\u540E\u8FD4\u56DE\u7ED9\u524D\u7AEF\u3002</li><li>Nginx \u9759\u6001\u538B\u7F29\uFF0C\u63D0\u524D\u628A\u6587\u4EF6\u538B\u7F29\u6210 .gz \u683C\u5F0F\uFF0C\u8BF7\u6C42\u6765\u4E86\uFF0C\u76F4\u63A5\u8FD4\u56DE\u5373\u53EF\u3002</li></ul><p>Nginx \u9759\u6001\u538B\u7F29\u9700\u8981\u8BBE\u7F6E\uFF1A</p><div class="language-Bash"><button title="Copy Code" class="copy"></button><span class="lang">Bash</span><pre class="shiki"><code><span class="line"><span style="color:#C9D1D9;">gzip_static  on</span><span style="color:#FF7B72;">;</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">\u5982\u4F55\u5224\u65AD gzip_static \u662F\u5426\u751F\u6548\uFF1F</p><p>\u5728\u8BF7\u6C42\u7684 response headers \u91CC\u9762\u7684 Etag \u91CC\u9762\uFF0C\u6CA1\u6709 <code>W/</code>\u5C31\u8868\u660E\u4F7F\u7528\u7684\u662F\u6211\u4EEC\u81EA\u5DF1\u7684 .gz \u6587\u4EF6\u3002</p></div><h3 id="\u56FE\u7247\u9632\u76D7\u94FE" tabindex="-1">\u56FE\u7247\u9632\u76D7\u94FE <a class="header-anchor" href="#\u56FE\u7247\u9632\u76D7\u94FE" aria-hidden="true">#</a></h3><p>\u9632\u76D7\u94FE\u7684\u539F\u7406\u5176\u5B9E\u5F88\u7B80\u5355\uFF0C\u76EE\u524D\u6BD4\u8F83\u6D41\u884C\u7684\u505A\u6CD5\u5C31\u662F\u901A\u8FC7 Referer \u6765\u8FDB\u884C\u5224\u65AD\u548C\u9650\u5236\uFF0CReferer \u7684\u89E3\u91CA\u8BF4\u660E\u5982\u4E0B\uFF1A</p><blockquote><p>HTTP Referer \u662F header \u7684\u4E00\u90E8\u5206\uFF0C\u5F53\u6D4F\u89C8\u5668\u5411 web \u670D\u52A1\u5668\u53D1\u9001\u8BF7\u6C42\u7684\u65F6\u5019\uFF0C\u4E00\u822C\u4F1A\u5E26\u4E0A Referer\uFF0C\u544A\u8BC9\u670D\u52A1\u5668\u6211\u662F\u4ECE\u54EA\u4E2A\u9875\u9762\u94FE\u63A5\u8FC7\u6765\u7684\uFF0C\u670D\u52A1\u5668\u57FA\u6B64\u53EF\u4EE5\u83B7\u5F97\u4E00\u4E9B\u4FE1\u606F\u7528\u4E8E\u5904\u7406\u3002\u2014\u2014\u5F15\u7528\u81EA\u767E\u5EA6\u767E\u79D1</p></blockquote><p>\u7B80\u5355\u6765\u8BF4\uFF0C\u5047\u5982\u6211\u535A\u5BA2\u57DF\u540D\u662F <a href="http://xn--devler-vy0j03sbubo1swtetzhynxzfn.cn" target="_blank" rel="noreferrer">devler.cn</a>\uFF0C\u6211\u5728 nginx \u4E2D\u8BBE\u7F6E\uFF0C\u53EA\u5141\u8BB8 Referer \u4E3A <code>*.devler.cn</code> \u7684\u6765\u6E90\u8BF7\u6C42\u56FE\u7247\uFF0C\u5176\u5B83\u7F51\u7AD9\u6765\u7684\u4E00\u5F8B\u7981\u6B62\u3002\u8FD9\u91CC\u6211\u4EEC\u9700\u8981\u7528\u5230 <code>ngx_http_referer_module</code> \u6A21\u5757\u548C <code>$invalid_referer</code> \u53D8\u91CF\uFF0C\u8BF7\u770B\u4E0B\u9762\u8FDB\u4E00\u6B65\u89E3\u91CA\u3002</p><h4 id="ngx-http-referer-module-\u6A21\u5757" tabindex="-1">ngx_http_referer_module \u6A21\u5757 <a class="header-anchor" href="#ngx-http-referer-module-\u6A21\u5757" aria-hidden="true">#</a></h4><p><code>ngx_http_referer_module</code> \u6A21\u5757\u7528\u4E8E\u963B\u6B62\u5BF9\u201CReferer\u201D\u5934\u5B57\u6BB5\u4E2D\u5177\u6709\u65E0\u6548\u503C\u7684\u8BF7\u6C42\u8BBF\u95EE\u7AD9\u70B9\u3002\u5E94\u8BE5\u8BB0\u4F4F\uFF0C\u4F7F\u7528\u9002\u5F53\u7684\u201CReferer\u201D\u5B57\u6BB5\u503C\u6765\u6784\u9020\u8BF7\u6C42\u975E\u5E38\u5BB9\u6613\uFF0C\u56E0\u6B64\u672C\u6A21\u5757\u7684\u9884\u671F\u76EE\u7684\u4E0D\u662F\u8981\u5F7B\u5E95\u963B\u6B62\u6B64\u7C7B\u8BF7\u6C42\uFF0C\u800C\u662F\u963B\u6B62\u5E38\u89C4\u6D4F\u89C8\u5668\u53D1\u9001\u7684\u8BF7\u6C42\u7684\u5927\u91CF\u6D41\u91CF\u3002\u8FD8\u5E94\u8BE5\u8003\u8651\u5230\uFF0C\u5373\u4F7F\u5BF9\u4E8E\u6709\u6548\u8BF7\u6C42\uFF0C\u5E38\u89C4\u6D4F\u89C8\u5668\u4E5F\u53EF\u80FD\u4E0D\u53D1\u9001\u201CReferer\u201D\u5B57\u6BB5\u3002</p><p>\u8BED\u6CD5\uFF1A<code>valid_referers none | blocked | server_names | string ...;</code></p><p>\u53EF\u7528\u4E8E\uFF1Aserver,location</p><p>\u53EF\u4EE5\u770B\u5230 valid_referers \u6307\u4EE4\u4E2D\u5B58\u5728\u4E00\u4E9B\u53C2\u6570\uFF0C\u6BD4\u5982 none|blocked\uFF0C\u542B\u4E49\u5982\u4E0B\uFF1A</p><ul><li>none\uFF1A\u8BF7\u6C42\u6807\u5934\u4E2D\u7F3A\u5C11\u201CReferer\u201D\u5B57\u6BB5\uFF0C\u4E5F\u5C31\u662F\u8BF4 Referer \u4E3A\u7A7A\uFF0C\u6D4F\u89C8\u5668\u76F4\u63A5\u8BBF\u95EE\u7684\u65F6\u5019 Referer \u4E00\u822C\u4E3A\u7A7A\u3002</li><li>blocked\uFF1A Referer\u201D\u5B57\u6BB5\u51FA\u73B0\u5728\u8BF7\u6C42\u6807\u5934\u4E2D\uFF0C\u4F46\u5176\u503C\u5DF2\u88AB\u9632\u706B\u5899\u6216\u4EE3\u7406\u670D\u52A1\u5668\u5220\u9664; \u8FD9\u4E9B\u503C\u662F\u4E0D\u4EE5\u201C<a href="http://xn--ivg/" target="_blank" rel="noreferrer">http://\u201D</a> \u6216 \u201C<a href="https://xn--ivg/" target="_blank" rel="noreferrer">https://\u201D</a> \u5F00\u5934\u7684\u5B57\u7B26\u4E32;</li><li>server_names\uFF1A \u670D\u52A1\u5668\u540D\u79F0\uFF0C\u4E5F\u5C31\u662F\u57DF\u540D\u5217\u8868\u3002</li></ul><p><code>$invalid_referer</code>\u53D8\u91CF</p><p>\u6211\u4EEC\u8BBE\u7F6E valid_referers \u6307\u4EE4\u540E\uFF0C\u4F1A\u5C06\u5176\u7ED3\u679C\u4F20\u9012\u7ED9\u4E00\u4E2A\u53D8\u91CF invalid_referer\uFF0C\u5176\u503C\u4E3A 0 \u6216 1\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u6307\u4EE4\u6765\u5B9E\u73B0\u9632\u76D7\u94FE\u529F\u80FD\uFF0C\u5982\u679C <code>$valid_referers</code>\u5217\u8868\u4E2D\u6CA1\u6709\u5305\u542B Referer \u5934\u7684\u503C\uFF0C<code>$invalid_referer</code>\u5C06\u88AB\u8BBE\u7F6E\u4E3A 1\u3002</p><h4 id="\u8BBE\u7F6E\u9632\u76D7\u94FE\u767D\u540D\u5355" tabindex="-1">\u8BBE\u7F6E\u9632\u76D7\u94FE\u767D\u540D\u5355 <a class="header-anchor" href="#\u8BBE\u7F6E\u9632\u76D7\u94FE\u767D\u540D\u5355" aria-hidden="true">#</a></h4><p>\u767D\u540D\u5355\u5C31\u662F\u53EA\u5141\u8BB8\u767D\u540D\u5355\u5185\u7684\u57DF\u540D\u8BBF\u95EE\uFF0C\u5176\u4F59\u4E00\u5F8B\u7981\u6B62\u3002</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">.*.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico|webp)$ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> valid_referers </span><span style="color:#C9D1D9;">none blocked *.devler.cn;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($invalid_referer) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">403</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4E0A\u9762\u7684\u914D\u7F6E\u542B\u4E49\u662F\u5148\u7528 location \u5339\u914D\u51FA\u9700\u8981\u7684\u683C\u5F0F\uFF08\u56FE\u7247\u548C\u89C6\u9891\uFF09\uFF0C\u7136\u540E\u7528 valid_referers \u6307\u4EE4\u8BBE\u7F6E\u5141\u8BB8\u7684\u57DF\u540D\uFF0C\u5176\u5B83\u57DF\u540D\u6CA1\u6709\u5305\u542B\u5728 valid_referers \u5217\u8868\u4E2D\uFF0C$invalid_referer \u53D8\u91CF\u8FD4\u56DE\u7684\u503C\u4E3A 1\uFF0C\u6700\u7EC8\u8FD4\u56DE 403\uFF0C\u7981\u6B62\u8BBF\u95EE\u3002\u4EE5\u4E0A\u5C31\u662F\u9632\u76D7\u94FE\u767D\u540D\u5355\u7684\u8BBE\u7F6E\u3002</p><h4 id="\u9632\u76D7\u94FE\u9ED1\u540D\u5355" tabindex="-1">\u9632\u76D7\u94FE\u9ED1\u540D\u5355 <a class="header-anchor" href="#\u9632\u76D7\u94FE\u9ED1\u540D\u5355" aria-hidden="true">#</a></h4><p>\u9ED1\u540D\u5355\u4E0E\u767D\u540D\u5355\u6B63\u597D\u76F8\u53CD\uFF0C\u5C31\u662F\u53EA\u7981\u6B62\u9ED1\u540D\u5355\u4E2D\u7684\u57DF\u540D\u8BF7\u6C42\uFF0C\u5176\u4F59\u4E00\u5F8B\u653E\u884C\uFF0C\u76F8\u6BD4\u767D\u540D\u5355\uFF0C\u9ED1\u540D\u5355\u7684\u9650\u5236\u66F4\u52A0\u5BBD\u677E\u3002\u7F51\u4E0A\u5927\u90E8\u5206\u6559\u7A0B\u53EA\u63D0\u5230\u4E86\u9632\u76D7\u94FE\u767D\u540D\u5355\u7684\u8BBE\u7F6E\uFF0C\u4E86\u89E3\u539F\u7406\u540E\u9ED1\u540D\u5355\u7684\u8BBE\u7F6E\u65B9\u6CD5\u4E5F\u5DEE\u4E0D\u591A\u3002</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">.*.(gif|jpg|jpeg|png|bmp|swf|flv|mp4|ico|webp)$ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> valid_referers </span><span style="color:#C9D1D9;">*.baidu.com;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($invalid_referer </span><span style="color:#FF7B72;">= </span><span style="color:#C9D1D9;">0) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">403</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4E0A\u9762\u7684\u914D\u7F6E\u4E2D\u6211\u4EEC\u7528 valid_referers \u6307\u4EE4\u8BBE\u7F6E\u9ED1\u540D\u5355\u57DF\u540D*.baidu.com\uFF0C\u83B7\u53D6\u5230\u6307\u5B9A\u7684 Referer \u5934\u4E4B\u540E\uFF0C$invalid_referer \u8FD4\u56DE\u503C\u4E3A 0\uFF0C\u6700\u7EC8\u8FD4\u56DE 403\uFF0C\u7981\u6B62\u767E\u5EA6\u7684\u57DF\u540D\u6765\u8BBF\u95EE\u3002</p><h2 id="\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B" tabindex="-1">\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B <a class="header-anchor" href="#\u5B8C\u6574\u914D\u7F6E\u793A\u4F8B" aria-hidden="true">#</a></h2><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#8B949E;">#\u5B9A\u4E49Nginx\u8FD0\u884C\u7684\u7528\u6237\u548C\u7528\u6237\u7EC4</span></span>
<span class="line"><span style="color:#FF7B72;">user </span><span style="color:#C9D1D9;">nginx;</span></span>
<span class="line"><span style="color:#8B949E;">#nginx\u8FDB\u7A0B\u6570\uFF0C\u901A\u5E38\u8BBE\u7F6E\u6210\u548Ccpu\u7684\u6570\u91CF\u76F8\u7B49</span></span>
<span class="line"><span style="color:#FF7B72;">worker_processes </span><span style="color:#C9D1D9;">4;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">#\u5168\u5C40\u9519\u8BEF\u65E5\u5FD7\u5B9A\u4E49\u4F4D\u7F6E\u548C\u7C7B\u578B\uFF0C[debug | info | notice | warn | error | crit]</span></span>
<span class="line"><span style="color:#8B949E;">#error_log  logs/error.log;</span></span>
<span class="line"><span style="color:#8B949E;">#error_log  logs/error.log  notice;</span></span>
<span class="line"><span style="color:#8B949E;">#error_log  logs/error.log  info;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">#\u8FDB\u7A0Bpid\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8B949E;">#pid        logs/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">#\u5DE5\u4F5C\u6A21\u5F0F\u53CA\u8FDE\u63A5\u6570\u4E0A\u9650</span></span>
<span class="line"><span style="color:#FF7B72;">events</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#epoll\u662F\u591A\u8DEF\u590D\u7528IO(I/O Multiplexing)\u4E2D\u7684\u4E00\u79CD\u65B9\u5F0F,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u4EC5\u7528\u4E8Elinux2.6\u4EE5\u4E0A\u5185\u6838,\u53EF\u4EE5\u5927\u5927\u63D0\u9AD8nginx\u7684\u6027\u80FD</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u53C2\u8003\u4E8B\u4EF6\u6A21\u578B\uFF0Cuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll\u6A21\u578B</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u662FLinux 2.6\u4EE5\u4E0A\u7248\u672C\u5185\u6838\u4E2D\u7684\u9AD8\u6027\u80FD\u7F51\u7EDCI/O\u6A21\u578B\uFF0Clinux\u5EFA\u8BAEepoll\uFF0C\u5982\u679C\u8DD1\u5728FreeBSD\u4E0A\u9762\uFF0C\u5C31\u7528kqueue\u6A21\u578B\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8865\u5145\u8BF4\u660E\uFF1A</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u4E0Eapache\u76F8\u7C7B\uFF0Cnginx\u9488\u5BF9\u4E0D\u540C\u7684\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u6709\u4E0D\u540C\u7684\u4E8B\u4EF6\u6A21\u578B</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#A\uFF09\u6807\u51C6\u4E8B\u4EF6\u6A21\u578B</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#Select\u3001poll\u5C5E\u4E8E\u6807\u51C6\u4E8B\u4EF6\u6A21\u578B\uFF0C\u5982\u679C\u5F53\u524D\u7CFB\u7EDF\u4E0D\u5B58\u5728\u66F4\u6709\u6548\u7684\u65B9\u6CD5\uFF0Cnginx\u4F1A\u9009\u62E9select\u6216poll</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#B\uFF09\u9AD8\u6548\u4E8B\u4EF6\u6A21\u578B</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#Kqueue\uFF1A\u4F7F\u7528\u4E8EFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 \u548C MacOS X.\u4F7F\u7528\u53CC\u5904\u7406\u5668\u7684MacOS X\u7CFB\u7EDF\u4F7F\u7528kqueue\u53EF\u80FD\u4F1A\u9020\u6210\u5185\u6838\u5D29\u6E83\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#Epoll\uFF1A\u4F7F\u7528\u4E8ELinux\u5185\u68382.6\u7248\u672C\u53CA\u4EE5\u540E\u7684\u7CFB\u7EDF\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#/dev/poll\uFF1A\u4F7F\u7528\u4E8ESolaris 7 11/99+\uFF0CHP/UX 11.22+ (eventport)\uFF0CIRIX 6.5.15+ \u548C Tru64 UNIX 5.1A+\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#Eventport\uFF1A\u4F7F\u7528\u4E8ESolaris 10\u3002 \u4E3A\u4E86\u9632\u6B62\u51FA\u73B0\u5185\u6838\u5D29\u6E83\u7684\u95EE\u9898\uFF0C \u6709\u5FC5\u8981\u5B89\u88C5\u5B89\u5168\u8865\u4E01\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> use </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;"> epoll</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5355\u4E2A\u8FDB\u7A0B\u6700\u5927\u8FDE\u63A5\u6570\uFF08\u6700\u5927\u8FDE\u63A5\u6570=\u8FDE\u63A5\u6570+\u8FDB\u7A0B\u6570\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u6839\u636E\u786C\u4EF6\u8C03\u6574\uFF0C\u548C\u524D\u9762\u5DE5\u4F5C\u8FDB\u7A0B\u914D\u5408\u8D77\u6765\u7528\uFF0C\u5C3D\u91CF\u5927\uFF0C\u4F46\u662F\u522B\u628Acup\u8DD1\u5230100%\u5C31\u884C\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> worker_connections </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">1024</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#keepalive \u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> keepalive_timeout </span><span style="color:#C9D1D9;">60;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5934\u90E8\u7684\u7F13\u51B2\u533A\u5927\u5C0F\u3002\u8FD9\u4E2A\u53EF\u4EE5\u6839\u636E\u4F60\u7684\u7CFB\u7EDF\u5206\u9875\u5927\u5C0F\u6765\u8BBE\u7F6E\uFF0C\u4E00\u822C\u4E00\u4E2A\u8BF7\u6C42\u5934\u7684\u5927\u5C0F\u4E0D\u4F1A\u8D85\u8FC71k\uFF0C\u4E0D\u8FC7\u7531\u4E8E\u4E00\u822C\u7CFB\u7EDF\u5206\u9875\u90FD\u8981\u5927\u4E8E1k\uFF0C\u6240\u4EE5\u8FD9\u91CC\u8BBE\u7F6E\u4E3A\u5206\u9875\u5927\u5C0F\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5206\u9875\u5927\u5C0F\u53EF\u4EE5\u7528\u547D\u4EE4getconf PAGESIZE \u53D6\u5F97\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#[root@web001 ~]# getconf PAGESIZE</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u4F46\u4E5F\u6709client_header_buffer_size\u8D85\u8FC74k\u7684\u60C5\u51B5\uFF0C\u4F46\u662Fclient_header_buffer_size\u8BE5\u503C\u5FC5\u987B\u8BBE\u7F6E\u4E3A\u201C\u7CFB\u7EDF\u5206\u9875\u5927\u5C0F\u201D\u7684\u6574\u500D\u6570\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> client_header_buffer_size </span><span style="color:#C9D1D9;">4k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8FD9\u4E2A\u5C06\u4E3A\u6253\u5F00\u6587\u4EF6\u6307\u5B9A\u7F13\u5B58\uFF0C\u9ED8\u8BA4\u662F\u6CA1\u6709\u542F\u7528\u7684\uFF0Cmax\u6307\u5B9A\u7F13\u5B58\u6570\u91CF\uFF0C\u5EFA\u8BAE\u548C\u6253\u5F00\u6587\u4EF6\u6570\u4E00\u81F4\uFF0Cinactive\u662F\u6307\u7ECF\u8FC7\u591A\u957F\u65F6\u95F4\u6587\u4EF6\u6CA1\u88AB\u8BF7\u6C42\u540E\u5220\u9664\u7F13\u5B58\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> open_file_cache </span><span style="color:#C9D1D9;">max=65535 inactive=60s;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8FD9\u4E2A\u662F\u6307\u591A\u957F\u65F6\u95F4\u68C0\u67E5\u4E00\u6B21\u7F13\u5B58\u7684\u6709\u6548\u4FE1\u606F\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BED\u6CD5:open_file_cache_valid time \u9ED8\u8BA4\u503C:open_file_cache_valid 60 \u4F7F\u7528\u5B57\u6BB5:http, server, location \u8FD9\u4E2A\u6307\u4EE4\u6307\u5B9A\u4E86\u4F55\u65F6\u9700\u8981\u68C0\u67E5open_file_cache\u4E2D\u7F13\u5B58\u9879\u76EE\u7684\u6709\u6548\u4FE1\u606F.</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> open_file_cache_valid </span><span style="color:#C9D1D9;">80s;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#open_file_cache\u6307\u4EE4\u4E2D\u7684inactive\u53C2\u6570\u65F6\u95F4\u5185\u6587\u4EF6\u7684\u6700\u5C11\u4F7F\u7528\u6B21\u6570\uFF0C\u5982\u679C\u8D85\u8FC7\u8FD9\u4E2A\u6570\u5B57\uFF0C\u6587\u4EF6\u63CF\u8FF0\u7B26\u4E00\u76F4\u662F\u5728\u7F13\u5B58\u4E2D\u6253\u5F00\u7684\uFF0C\u5982\u4E0A\u4F8B\uFF0C\u5982\u679C\u6709\u4E00\u4E2A\u6587\u4EF6\u5728inactive\u65F6\u95F4\u5185\u4E00\u6B21\u6CA1\u88AB\u4F7F\u7528\uFF0C\u5B83\u5C06\u88AB\u79FB\u9664\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BED\u6CD5:open_file_cache_min_uses number \u9ED8\u8BA4\u503C:open_file_cache_min_uses 1 \u4F7F\u7528\u5B57\u6BB5:http, server, location  \u8FD9\u4E2A\u6307\u4EE4\u6307\u5B9A\u4E86\u5728open_file_cache\u6307\u4EE4\u65E0\u6548\u7684\u53C2\u6570\u4E2D\u4E00\u5B9A\u7684\u65F6\u95F4\u8303\u56F4\u5185\u53EF\u4EE5\u4F7F\u7528\u7684\u6700\u5C0F\u6587\u4EF6\u6570,\u5982\u679C\u4F7F\u7528\u66F4\u5927\u7684\u503C,\u6587\u4EF6\u63CF\u8FF0\u7B26\u5728cache\u4E2D\u603B\u662F\u6253\u5F00\u72B6\u6001.</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> open_file_cache_min_uses </span><span style="color:#C9D1D9;">1;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BED\u6CD5:open_file_cache_errors on | off \u9ED8\u8BA4\u503C:open_file_cache_errors off \u4F7F\u7528\u5B57\u6BB5:http, server, location \u8FD9\u4E2A\u6307\u4EE4\u6307\u5B9A\u662F\u5426\u5728\u641C\u7D22\u4E00\u4E2A\u6587\u4EF6\u662F\u8BB0\u5F55cache\u9519\u8BEF.</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> open_file_cache_errors </span><span style="color:#C9D1D9;">on;</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">#\u8BBE\u5B9Ahttp\u670D\u52A1\u5668\uFF0C\u5229\u7528\u5B83\u7684\u53CD\u5411\u4EE3\u7406\u529F\u80FD\u63D0\u4F9B\u8D1F\u8F7D\u5747\u8861\u652F\u6301</span></span>
<span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u6587\u4EF6\u6269\u5C55\u540D\u4E0E\u6587\u4EF6\u7C7B\u578B\u6620\u5C04\u8868\u3002\u8BBE\u5B9Amime\u7C7B\u578B,\u7C7B\u578B\u7531mime.type\u6587\u4EF6\u5B9A\u4E49</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> include </span><span style="color:#C9D1D9;">/etc/nginx/mime.types;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u9ED8\u8BA4\u6587\u4EF6\u7C7B\u578B</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> default_type </span><span style="color:#C9D1D9;">application/octet-stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u9ED8\u8BA4\u7F16\u7801</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> charset </span><span style="color:#C9D1D9;">utf-8;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u65E5\u5FD7\u683C\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> log_format </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">  </span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#C9D1D9;">remote_addr</span><span style="color:#A5D6FF;"> - $</span><span style="color:#C9D1D9;">remote_user</span><span style="color:#A5D6FF;"> [$</span><span style="color:#C9D1D9;">time_local</span><span style="color:#A5D6FF;">] &quot;$</span><span style="color:#C9D1D9;">request</span><span style="color:#A5D6FF;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">                      </span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#C9D1D9;">status</span><span style="color:#A5D6FF;"> $</span><span style="color:#C9D1D9;">body_bytes_sent</span><span style="color:#A5D6FF;"> &quot;$</span><span style="color:#C9D1D9;">http_referer</span><span style="color:#A5D6FF;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">                      </span><span style="color:#A5D6FF;">&#39;&quot;$</span><span style="color:#C9D1D9;">http_user_agent</span><span style="color:#A5D6FF;">&quot; &quot;$</span><span style="color:#C9D1D9;">http_x_forwarded_for</span><span style="color:#A5D6FF;">&quot;&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># \u8BBF\u95EE\u65E5\u5FD7</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> access_log </span><span style="color:#C9D1D9;"> logs/access.log </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u670D\u52A1\u5668\u540D\u5B57\u7684hash\u8868\u5927\u5C0F</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u4FDD\u5B58\u670D\u52A1\u5668\u540D\u5B57\u7684hash\u8868\u662F\u7531\u6307\u4EE4server_names_hash_max_size \u548Cserver_names_hash_bucket_size\u6240\u63A7\u5236\u7684\u3002\u53C2\u6570hash bucket size\u603B\u662F\u7B49\u4E8Ehash\u8868\u7684\u5927\u5C0F\uFF0C\u5E76\u4E14\u662F\u4E00\u8DEF\u5904\u7406\u5668\u7F13\u5B58\u5927\u5C0F\u7684\u500D\u6570\u3002\u5728\u51CF\u5C11\u4E86\u5728\u5185\u5B58\u4E2D\u7684\u5B58\u53D6\u6B21\u6570\u540E\uFF0C\u4F7F\u5728\u5904\u7406\u5668\u4E2D\u52A0\u901F\u67E5\u627Ehash\u8868\u952E\u503C\u6210\u4E3A\u53EF\u80FD\u3002\u5982\u679Chash bucket size\u7B49\u4E8E\u4E00\u8DEF\u5904\u7406\u5668\u7F13\u5B58\u7684\u5927\u5C0F\uFF0C\u90A3\u4E48\u5728\u67E5\u627E\u952E\u7684\u65F6\u5019\uFF0C\u6700\u574F\u7684\u60C5\u51B5\u4E0B\u5728\u5185\u5B58\u4E2D\u67E5\u627E\u7684\u6B21\u6570\u4E3A2\u3002\u7B2C\u4E00\u6B21\u662F\u786E\u5B9A\u5B58\u50A8\u5355\u5143\u7684\u5730\u5740\uFF0C\u7B2C\u4E8C\u6B21\u662F\u5728\u5B58\u50A8\u5355\u5143\u4E2D\u67E5\u627E\u952E \u503C\u3002\u56E0\u6B64\uFF0C\u5982\u679CNginx\u7ED9\u51FA\u9700\u8981\u589E\u5927hash max size \u6216 hash bucket size\u7684\u63D0\u793A\uFF0C\u90A3\u4E48\u9996\u8981\u7684\u662F\u589E\u5927\u524D\u4E00\u4E2A\u53C2\u6570\u7684\u5927\u5C0F.</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> server_names_hash_bucket_size </span><span style="color:#C9D1D9;">128;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5BA2\u6237\u7AEF\u8BF7\u6C42\u5934\u90E8\u7684\u7F13\u51B2\u533A\u5927\u5C0F\u3002\u8FD9\u4E2A\u53EF\u4EE5\u6839\u636E\u4F60\u7684\u7CFB\u7EDF\u5206\u9875\u5927\u5C0F\u6765\u8BBE\u7F6E\uFF0C\u4E00\u822C\u4E00\u4E2A\u8BF7\u6C42\u7684\u5934\u90E8\u5927\u5C0F\u4E0D\u4F1A\u8D85\u8FC71k\uFF0C\u4E0D\u8FC7\u7531\u4E8E\u4E00\u822C\u7CFB\u7EDF\u5206\u9875\u90FD\u8981\u5927\u4E8E1k\uFF0C\u6240\u4EE5\u8FD9\u91CC\u8BBE\u7F6E\u4E3A\u5206\u9875\u5927\u5C0F\u3002\u5206\u9875\u5927\u5C0F\u53EF\u4EE5\u7528\u547D\u4EE4getconf PAGESIZE\u53D6\u5F97\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> client_header_buffer_size </span><span style="color:#C9D1D9;">32k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5BA2\u6237\u8BF7\u6C42\u5934\u7F13\u51B2\u5927\u5C0F\u3002nginx\u9ED8\u8BA4\u4F1A\u7528client_header_buffer_size\u8FD9\u4E2Abuffer\u6765\u8BFB\u53D6header\u503C\uFF0C\u5982\u679Cheader\u8FC7\u5927\uFF0C\u5B83\u4F1A\u4F7F\u7528large_client_header_buffers\u6765\u8BFB\u53D6\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> large_client_header_buffers </span><span style="color:#C9D1D9;">4 </span><span style="color:#79C0FF;">64k</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u901A\u8FC7nginx\u4E0A\u4F20\u6587\u4EF6\u7684\u5927\u5C0F</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;">8m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5F00\u542F\u9AD8\u6548\u6587\u4EF6\u4F20\u8F93\u6A21\u5F0F\uFF0Csendfile\u6307\u4EE4\u6307\u5B9Anginx\u662F\u5426\u8C03\u7528sendfile\u51FD\u6570\u6765\u8F93\u51FA\u6587\u4EF6\uFF0C\u5BF9\u4E8E\u666E\u901A\u5E94\u7528\u8BBE\u4E3A on\uFF0C\u5982\u679C\u7528\u6765\u8FDB\u884C\u4E0B\u8F7D\u7B49\u5E94\u7528\u78C1\u76D8IO\u91CD\u8D1F\u8F7D\u5E94\u7528\uFF0C\u53EF\u8BBE\u7F6E\u4E3Aoff\uFF0C\u4EE5\u5E73\u8861\u78C1\u76D8\u4E0E\u7F51\u7EDCI/O\u5904\u7406\u901F\u5EA6\uFF0C\u964D\u4F4E\u7CFB\u7EDF\u7684\u8D1F\u8F7D\u3002\u6CE8\u610F\uFF1A\u5982\u679C\u56FE\u7247\u663E\u793A\u4E0D\u6B63\u5E38\u628A\u8FD9\u4E2A\u6539\u6210off\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#sendfile\u6307\u4EE4\u6307\u5B9A nginx \u662F\u5426\u8C03\u7528sendfile \u51FD\u6570\uFF08zero copy \u65B9\u5F0F\uFF09\u6765\u8F93\u51FA\u6587\u4EF6\uFF0C\u5BF9\u4E8E\u666E\u901A\u5E94\u7528\uFF0C\u5FC5\u987B\u8BBE\u4E3Aon\u3002\u5982\u679C\u7528\u6765\u8FDB\u884C\u4E0B\u8F7D\u7B49\u5E94\u7528\u78C1\u76D8IO\u91CD\u8D1F\u8F7D\u5E94\u7528\uFF0C\u53EF\u8BBE\u7F6E\u4E3Aoff\uFF0C\u4EE5\u5E73\u8861\u78C1\u76D8\u4E0E\u7F51\u7EDCIO\u5904\u7406\u901F\u5EA6\uFF0C\u964D\u4F4E\u7CFB\u7EDFuptime\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> sendfile </span><span style="color:#C9D1D9;">on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#sendfile \u6307\u4EE4\u6307\u5B9A nginx \u662F\u5426\u8C03\u7528 sendfile \u51FD\u6570\uFF08zero copy \u65B9\u5F0F\uFF09\u6765\u8F93\u51FA\u6587\u4EF6\uFF0C</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5BF9\u4E8E\u666E\u901A\u5E94\u7528\uFF0C\u5FC5\u987B\u8BBE\u4E3A on,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u5982\u679C\u7528\u6765\u8FDB\u884C\u4E0B\u8F7D\u7B49\u5E94\u7528\u78C1\u76D8IO\u91CD\u8D1F\u8F7D\u5E94\u7528\uFF0C\u53EF\u8BBE\u7F6E\u4E3A off\uFF0C</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u4EE5\u5E73\u8861\u78C1\u76D8\u4E0E\u7F51\u7EDCI/O\u5904\u7406\u901F\u5EA6\uFF0C\u964D\u4F4E\u7CFB\u7EDF\u7684uptime.</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> sendfile </span><span style="color:#C9D1D9;">   </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u6B64\u9009\u9879\u5141\u8BB8\u6216\u7981\u6B62\u4F7F\u7528socke\u7684TCP_CORK\u7684\u9009\u9879\uFF0C\u6B64\u9009\u9879\u4EC5\u5728\u4F7F\u7528sendfile\u7684\u65F6\u5019\u4F7F\u7528</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> tcp_nopush </span><span style="color:#C9D1D9;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u957F\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4\uFF0C\u5355\u4F4D\u662F\u79D2</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> keepalive_timeout </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">65</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> tcp_nodelay </span><span style="color:#C9D1D9;">   </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#gzip\u6A21\u5757\u8BBE\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip </span><span style="color:#C9D1D9;">on; </span><span style="color:#8B949E;">#\u5F00\u542Fgzip\u538B\u7F29\u8F93\u51FA</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_min_length </span><span style="color:#C9D1D9;">1k;    </span><span style="color:#8B949E;">#\u6700\u5C0F\u538B\u7F29\u6587\u4EF6\u5927\u5C0F</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_buffers </span><span style="color:#C9D1D9;">4 </span><span style="color:#79C0FF;">16k</span><span style="color:#C9D1D9;">;    </span><span style="color:#8B949E;">#\u538B\u7F29\u7F13\u51B2\u533A</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_http_version </span><span style="color:#C9D1D9;">1.0; </span><span style="color:#8B949E;">#\u538B\u7F29\u7248\u672C\uFF08\u9ED8\u8BA41.1\uFF0C\u524D\u7AEF\u5982\u679C\u662Fsquid2.5\u8BF7\u4F7F\u75281.0\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_comp_level </span><span style="color:#C9D1D9;">2;     </span><span style="color:#8B949E;">#\u538B\u7F29\u7B49\u7EA7</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_types </span><span style="color:#C9D1D9;">text/plain application/x-javascript text/css application/xml;    </span><span style="color:#8B949E;">#\u538B\u7F29\u7C7B\u578B\uFF0C\u9ED8\u8BA4\u5C31\u5DF2\u7ECF\u5305\u542Btextml\uFF0C\u6240\u4EE5\u4E0B\u9762\u5C31\u4E0D\u7528\u518D\u5199\u4E86\uFF0C\u5199\u4E0A\u53BB\u4E5F\u4E0D\u4F1A\u6709\u95EE\u9898\uFF0C\u4F46\u662F\u4F1A\u6709\u4E00\u4E2Awarn\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> gzip_vary </span><span style="color:#C9D1D9;">on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#FastCGI\u76F8\u5173\u53C2\u6570\u662F\u4E3A\u4E86\u6539\u5584\u7F51\u7AD9\u7684\u6027\u80FD\uFF1A\u51CF\u5C11\u8D44\u6E90\u5360\u7528\uFF0C\u63D0\u9AD8\u8BBF\u95EE\u901F\u5EA6\u3002\u4E0B\u9762\u53C2\u6570\u770B\u5B57\u9762\u610F\u601D\u90FD\u80FD\u7406\u89E3\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_connect_timeout </span><span style="color:#C9D1D9;">300;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_send_timeout </span><span style="color:#C9D1D9;">300;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_read_timeout </span><span style="color:#C9D1D9;">300;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_buffer_size </span><span style="color:#C9D1D9;">64k;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_buffers </span><span style="color:#C9D1D9;">4 </span><span style="color:#79C0FF;">64k</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_busy_buffers_size </span><span style="color:#C9D1D9;">128k;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> fastcgi_temp_file_write_size </span><span style="color:#C9D1D9;">128k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u8BF7\u6C42\u7F13\u51B2</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> client_header_buffer_size </span><span style="color:#C9D1D9;">   </span><span style="color:#79C0FF;">128k</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> large_client_header_buffers </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">4</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">128k</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8D1F\u8F7D\u5747\u8861\u914D\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">upstream</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">piao.jd.com </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#upstream\u7684\u8D1F\u8F7D\u5747\u8861\uFF0Cweight\u662F\u6743\u91CD\uFF0C\u53EF\u4EE5\u6839\u636E\u673A\u5668\u914D\u7F6E\u5B9A\u4E49\u6743\u91CD\u3002weigth\u53C2\u6570\u8868\u793A\u6743\u503C\uFF0C\u6743\u503C\u8D8A\u9AD8\u88AB\u5206\u914D\u5230\u7684\u51E0\u7387\u8D8A\u5927\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 192.168.80.121:80 </span><span style="color:#FFA657;">weight</span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">3</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">        server 192.168.80.122:80 </span><span style="color:#FFA657;">weight</span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">2</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">        server 192.168.80.123:80 </span><span style="color:#FFA657;">weight</span><span style="color:#FF7B72;">=</span><span style="color:#79C0FF;">3</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#nginx\u7684upstream\u76EE\u524D\u652F\u63014\u79CD\u65B9\u5F0F\u7684\u5206\u914D</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#1\u3001\u8F6E\u8BE2\uFF08\u9ED8\u8BA4\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u6BCF\u4E2A\u8BF7\u6C42\u6309\u65F6\u95F4\u987A\u5E8F\u9010\u4E00\u5206\u914D\u5230\u4E0D\u540C\u7684\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u5982\u679C\u540E\u7AEF\u670D\u52A1\u5668down\u6389\uFF0C\u80FD\u81EA\u52A8\u5254\u9664\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#2\u3001weight</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u6307\u5B9A\u8F6E\u8BE2\u51E0\u7387\uFF0Cweight\u548C\u8BBF\u95EE\u6BD4\u7387\u6210\u6B63\u6BD4\uFF0C\u7528\u4E8E\u540E\u7AEF\u670D\u52A1\u5668\u6027\u80FD\u4E0D\u5747\u7684\u60C5\u51B5\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u4F8B\u5982\uFF1A</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#upstream bakend {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 192.168.0.14 weight=10;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 192.168.0.15 weight=10;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#}</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#2\u3001ip_hash</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u6BCF\u4E2A\u8BF7\u6C42\u6309\u8BBF\u95EEip\u7684hash\u7ED3\u679C\u5206\u914D\uFF0C\u8FD9\u6837\u6BCF\u4E2A\u8BBF\u5BA2\u56FA\u5B9A\u8BBF\u95EE\u4E00\u4E2A\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u53EF\u4EE5\u89E3\u51B3session\u7684\u95EE\u9898\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u4F8B\u5982\uFF1A</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#upstream bakend {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    ip_hash;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 192.168.0.14:88;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 192.168.0.15:80;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#}</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#3\u3001fair\uFF08\u7B2C\u4E09\u65B9\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u6309\u540E\u7AEF\u670D\u52A1\u5668\u7684\u54CD\u5E94\u65F6\u95F4\u6765\u5206\u914D\u8BF7\u6C42\uFF0C\u54CD\u5E94\u65F6\u95F4\u77ED\u7684\u4F18\u5148\u5206\u914D\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#upstream backend {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server server1;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server server2;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    fair;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#}</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#4\u3001url_hash\uFF08\u7B2C\u4E09\u65B9\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u6309\u8BBF\u95EEurl\u7684hash\u7ED3\u679C\u6765\u5206\u914D\u8BF7\u6C42\uFF0C\u4F7F\u6BCF\u4E2Aurl\u5B9A\u5411\u5230\u540C\u4E00\u4E2A\u540E\u7AEF\u670D\u52A1\u5668\uFF0C\u540E\u7AEF\u670D\u52A1\u5668\u4E3A\u7F13\u5B58\u65F6\u6BD4\u8F83\u6709\u6548\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u4F8B\uFF1A\u5728upstream\u4E2D\u52A0\u5165hash\u8BED\u53E5\uFF0Cserver\u8BED\u53E5\u4E2D\u4E0D\u80FD\u5199\u5165weight\u7B49\u5176\u4ED6\u7684\u53C2\u6570\uFF0Chash_method\u662F\u4F7F\u7528\u7684hash\u7B97\u6CD5</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#upstream backend {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server squid1:3128;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server squid2:3128;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    hash $request_uri;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    hash_method crc32;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#tips:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#upstream bakend{#\u5B9A\u4E49\u8D1F\u8F7D\u5747\u8861\u8BBE\u5907\u7684Ip\u53CA\u8BBE\u5907\u72B6\u6001}{</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    ip_hash;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 127.0.0.1:9090 down;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 127.0.0.1:8080 weight=2;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 127.0.0.1:6060;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#    server 127.0.0.1:7070 backup;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#}</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u5728\u9700\u8981\u4F7F\u7528\u8D1F\u8F7D\u5747\u8861\u7684server\u4E2D\u589E\u52A0 proxy_pass http://bakend/;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u6BCF\u4E2A\u8BBE\u5907\u7684\u72B6\u6001\u8BBE\u7F6E\u4E3A:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#1.down\u8868\u793A\u5355\u524D\u7684server\u6682\u65F6\u4E0D\u53C2\u4E0E\u8D1F\u8F7D</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#2.weight\u4E3Aweight\u8D8A\u5927\uFF0C\u8D1F\u8F7D\u7684\u6743\u91CD\u5C31\u8D8A\u5927\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#3.max_fails\uFF1A\u5141\u8BB8\u8BF7\u6C42\u5931\u8D25\u7684\u6B21\u6570\u9ED8\u8BA4\u4E3A1.\u5F53\u8D85\u8FC7\u6700\u5927\u6B21\u6570\u65F6\uFF0C\u8FD4\u56DEproxy_next_upstream\u6A21\u5757\u5B9A\u4E49\u7684\u9519\u8BEF</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#4.fail_timeout:max_fails\u6B21\u5931\u8D25\u540E\uFF0C\u6682\u505C\u7684\u65F6\u95F4\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#5.backup\uFF1A \u5176\u5B83\u6240\u6709\u7684\u975Ebackup\u673A\u5668down\u6216\u8005\u5FD9\u7684\u65F6\u5019\uFF0C\u8BF7\u6C42backup\u673A\u5668\u3002\u6240\u4EE5\u8FD9\u53F0\u673A\u5668\u538B\u529B\u4F1A\u6700\u8F7B\u3002</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#nginx\u652F\u6301\u540C\u65F6\u8BBE\u7F6E\u591A\u7EC4\u7684\u8D1F\u8F7D\u5747\u8861\uFF0C\u7528\u6765\u7ED9\u4E0D\u7528\u7684server\u6765\u4F7F\u7528\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#client_body_in_file_only\u8BBE\u7F6E\u4E3AOn \u53EF\u4EE5\u8BB2client post\u8FC7\u6765\u7684\u6570\u636E\u8BB0\u5F55\u5230\u6587\u4EF6\u4E2D\u7528\u6765\u505Adebug</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#client_body_temp_path\u8BBE\u7F6E\u8BB0\u5F55\u6587\u4EF6\u7684\u76EE\u5F55 \u53EF\u4EE5\u8BBE\u7F6E\u6700\u591A3\u5C42\u76EE\u5F55</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#location\u5BF9URL\u8FDB\u884C\u5339\u914D.\u53EF\u4EE5\u8FDB\u884C\u91CD\u5B9A\u5411\u6216\u8005\u8FDB\u884C\u65B0\u7684\u4EE3\u7406 \u8D1F\u8F7D\u5747\u8861</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u865A\u62DF\u4E3B\u673A\u914D\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">    server {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u4FA6\u542C80\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#C9D1D9;">        listen    </span><span style="color:#79C0FF;">80</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># \u57DF\u540D\u53EF\u4EE5\u6709\u591A\u4E2A\uFF0C\u7528\u7A7A\u683C\u9694\u5F00\u3002\u53EF\u4EE5\u4F7F\u7528ip</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;"> blog.redis.com.cn;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># \u9ED8\u8BA4\u5165\u53E3\u6587\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.html index.htm;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u5B9A\u4E49\u670D\u52A1\u5668\u7684\u9ED8\u8BA4\u7F51\u7AD9\u6839\u76EE\u5F55\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;">/www;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u672C\u865A\u62DF\u4E3B\u673A\u7684\u8BBF\u95EE\u65E5\u5FD7</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> access_log </span><span style="color:#C9D1D9;"> logs/nginx.access.log </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># \u6839\u636E\u8BF7\u6C42 URI \u8BBE\u7F6E\u914D\u7F6E\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u5B9A\u4E49\u9996\u9875\u7D22\u5F15\u6587\u4EF6\u7684\u540D\u79F0</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;">index.php index.html index.htm;</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># \u7981\u6B62ip1-200\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># deny xxx.xxx.xxx.1/200;</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># deng all;</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># \u5141\u8BB8\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># allow xxx.xxx.xxx.1/200;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># \u5B9A\u4E49\u9519\u8BEF\u63D0\u793A\u9875\u9762</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;"> error_page </span><span style="color:#C9D1D9;">500 </span><span style="color:#79C0FF;">502</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">503</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">504</span><span style="color:#C9D1D9;"> /50x.html;</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">/50x.html </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># \u9759\u6001\u6587\u4EF6\uFF0C\u8BBE\u7F6E\u7F13\u5B58\u65F6\u95F4</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">^/(images|javascript|js|css|flash|media|static)/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8FC7\u671F30\u5929\uFF0C\u9759\u6001\u6587\u4EF6\u4E0D\u600E\u4E48\u66F4\u65B0\uFF0C\u8FC7\u671F\u53EF\u4EE5\u8BBE\u5927\u4E00\u70B9\uFF0C</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u5982\u679C\u9891\u7E41\u66F4\u65B0\uFF0C\u5219\u53EF\u4EE5\u8BBE\u7F6E\u5F97\u5C0F\u4E00\u70B9\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> expires </span><span style="color:#C9D1D9;">30d;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#PHP \u811A\u672C\u8BF7\u6C42\u5168\u90E8\u8F6C\u53D1\u5230 FastCGI\u5904\u7406. \u4F7F\u7528FastCGI\u9ED8\u8BA4\u914D\u7F6E.</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">.php$ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> fastcgi_pass </span><span style="color:#C9D1D9;">127.0.0.1:9000;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> fastcgi_index </span><span style="color:#C9D1D9;">index.php;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> fastcgi_param </span><span style="color:#C9D1D9;"> SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> include </span><span style="color:#C9D1D9;">fastcgi_params;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># \u5BF9 &quot;/connect-controller&quot; \u542F\u7528\u53CD\u5411\u4EE3\u7406</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/connect-controller </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># \u4EE3\u7406\u5730\u5740\uFF1A\u5F53\u7528\u6237\u4F7F\u7528\u63A5\u53E3 http://xy.xxx.com/xxx \u7684\u65F6\u5019\uFF0Cnginx\u4F1A\u81EA\u52A8\u6307\u5411\u5185\u90E8\u670D\u52A1\u5668 http://127.0.0.1:88/xxx\u7684</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># \u5177\u4F53\u53C2\u8003\u94FE\u63A5\uFF1Ahttps://blog.csdn.net/yujia_666/article/details/111595082</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://127.0.0.1:88; </span><span style="color:#8B949E;">#\u8BF7\u6CE8\u610F\u6B64\u5904\u7AEF\u53E3\u53F7\u4E0D\u80FD\u4E0E\u865A\u62DF\u4E3B\u673A\u76D1\u542C\u7684\u7AEF\u53E3\u53F7\u4E00\u6837\uFF08\u4E5F\u5C31\u662Fserver\u76D1\u542C\u7684\u7AEF\u53E3\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_redirect </span><span style="color:#C9D1D9;">off;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># proxy_set_header \u7528\u6765\u91CD\u5B9A\u4E49\u53D1\u5F80\u540E\u7AEF\u670D\u52A1\u5668\u7684\u8BF7\u6C42\u5934\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># proxy_set_header\u662Fnginx\u8BBE\u7F6E\u8BF7\u6C42\u5934\u7ED9\u4E0A\u6E38\u670D\u52A1\u5668</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># add_header\u662Fnginx\u8BBE\u7F6E\u54CD\u5E94\u5934\u4FE1\u606F\u7ED9\u6D4F\u89C8\u5668\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;"># \u53C2\u8003\uFF1Ahttps://blog.csdn.net/qq_38826019/article/details/109176896</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Real-IP $remote_addr;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u540E\u7AEF\u7684Web\u670D\u52A1\u5668\u53EF\u4EE5\u901A\u8FC7X-Forwarded-For\u83B7\u53D6\u7528\u6237\u771F\u5B9EIP</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u4EE5\u4E0B\u662F\u4E00\u4E9B\u53CD\u5411\u4EE3\u7406\u7684\u914D\u7F6E\uFF0C\u53EF\u9009\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Host $host;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u5141\u8BB8\u5BA2\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5355\u6587\u4EF6\u5B57\u8282\u6570</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;">10m;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u7F13\u51B2\u533A\u4EE3\u7406\u7F13\u51B2\u7528\u6237\u7AEF\u8BF7\u6C42\u7684\u6700\u5927\u5B57\u8282\u6570\uFF0C</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u5982\u679C\u628A\u5B83\u8BBE\u7F6E\u4E3A\u6BD4\u8F83\u5927\u7684\u6570\u503C\uFF0C\u4F8B\u5982256k\uFF0C\u90A3\u4E48\uFF0C\u65E0\u8BBA\u4F7F\u7528firefox\u8FD8\u662FIE\u6D4F\u89C8\u5668\uFF0C\u6765\u63D0\u4EA4\u4EFB\u610F\u5C0F\u4E8E256k\u7684\u56FE\u7247\uFF0C\u90FD\u5F88\u6B63\u5E38\u3002\u5982\u679C\u6CE8\u91CA\u8BE5\u6307\u4EE4\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u7684client_body_buffer_size\u8BBE\u7F6E\uFF0C\u4E5F\u5C31\u662F\u64CD\u4F5C\u7CFB\u7EDF\u9875\u9762\u5927\u5C0F\u7684\u4E24\u500D\uFF0C8k\u6216\u800516k\uFF0C\u95EE\u9898\u5C31\u51FA\u73B0\u4E86\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u65E0\u8BBA\u4F7F\u7528firefox4.0\u8FD8\u662FIE8.0\uFF0C\u63D0\u4EA4\u4E00\u4E2A\u6BD4\u8F83\u5927\uFF0C200k\u5DE6\u53F3\u7684\u56FE\u7247\uFF0C\u90FD\u8FD4\u56DE500 Internal Server Error\u9519\u8BEF</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> client_body_buffer_size </span><span style="color:#C9D1D9;">128k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8868\u793A\u4F7Fnginx\u963B\u6B62HTTP\u5E94\u7B54\u4EE3\u7801\u4E3A400\u6216\u8005\u66F4\u9AD8\u7684\u5E94\u7B54\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_intercept_errors </span><span style="color:#C9D1D9;">on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u540E\u7AEF\u670D\u52A1\u5668\u8FDE\u63A5\u7684\u8D85\u65F6\u65F6\u95F4_\u53D1\u8D77\u63E1\u624B\u7B49\u5019\u54CD\u5E94\u8D85\u65F6\u65F6\u95F4</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#nginx\u8DDF\u540E\u7AEF\u670D\u52A1\u5668\u8FDE\u63A5\u8D85\u65F6\u65F6\u95F4(\u4EE3\u7406\u8FDE\u63A5\u8D85\u65F6)</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_connect_timeout </span><span style="color:#C9D1D9;">90;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u540E\u7AEF\u670D\u52A1\u5668\u6570\u636E\u56DE\u4F20\u65F6\u95F4(\u4EE3\u7406\u53D1\u9001\u8D85\u65F6)</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u540E\u7AEF\u670D\u52A1\u5668\u6570\u636E\u56DE\u4F20\u65F6\u95F4_\u5C31\u662F\u5728\u89C4\u5B9A\u65F6\u95F4\u4E4B\u5185\u540E\u7AEF\u670D\u52A1\u5668\u5FC5\u987B\u4F20\u5B8C\u6240\u6709\u7684\u6570\u636E</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_send_timeout </span><span style="color:#C9D1D9;">90;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8FDE\u63A5\u6210\u529F\u540E\uFF0C\u540E\u7AEF\u670D\u52A1\u5668\u54CD\u5E94\u65F6\u95F4(\u4EE3\u7406\u63A5\u6536\u8D85\u65F6)</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8FDE\u63A5\u6210\u529F\u540E_\u7B49\u5019\u540E\u7AEF\u670D\u52A1\u5668\u54CD\u5E94\u65F6\u95F4_\u5176\u5B9E\u5DF2\u7ECF\u8FDB\u5165\u540E\u7AEF\u7684\u6392\u961F\u4E4B\u4E2D\u7B49\u5019\u5904\u7406\uFF08\u4E5F\u53EF\u4EE5\u8BF4\u662F\u540E\u7AEF\u670D\u52A1\u5668\u5904\u7406\u8BF7\u6C42\u7684\u65F6\u95F4\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_read_timeout </span><span style="color:#C9D1D9;">90;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8BBE\u7F6E\u4EE3\u7406\u670D\u52A1\u5668\uFF08nginx\uFF09\u4FDD\u5B58\u7528\u6237\u5934\u4FE1\u606F\u7684\u7F13\u51B2\u533A\u5927\u5C0F</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8BBE\u7F6E\u4ECE\u88AB\u4EE3\u7406\u670D\u52A1\u5668\u8BFB\u53D6\u7684\u7B2C\u4E00\u90E8\u5206\u5E94\u7B54\u7684\u7F13\u51B2\u533A\u5927\u5C0F\uFF0C\u901A\u5E38\u60C5\u51B5\u4E0B\u8FD9\u90E8\u5206\u5E94\u7B54\u4E2D\u5305\u542B\u4E00\u4E2A\u5C0F\u7684\u5E94\u7B54\u5934\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u8FD9\u4E2A\u503C\u7684\u5927\u5C0F\u4E3A\u6307\u4EE4proxy_buffers\u4E2D\u6307\u5B9A\u7684\u4E00\u4E2A\u7F13\u51B2\u533A\u7684\u5927\u5C0F\uFF0C\u4E0D\u8FC7\u53EF\u4EE5\u5C06\u5176\u8BBE\u7F6E\u4E3A\u66F4\u5C0F</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_buffer_size </span><span style="color:#C9D1D9;">4k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#proxy_buffers\u7F13\u51B2\u533A\uFF0C\u7F51\u9875\u5E73\u5747\u572832k\u4EE5\u4E0B\u7684\u8BBE\u7F6E</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8BBE\u7F6E\u7528\u4E8E\u8BFB\u53D6\u5E94\u7B54\uFF08\u6765\u81EA\u88AB\u4EE3\u7406\u670D\u52A1\u5668\uFF09\u7684\u7F13\u51B2\u533A\u6570\u76EE\u548C\u5927\u5C0F\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E5F\u4E3A\u5206\u9875\u5927\u5C0F\uFF0C\u6839\u636E\u64CD\u4F5C\u7CFB\u7EDF\u7684\u4E0D\u540C\u53EF\u80FD\u662F4k\u6216\u80058k</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_buffers </span><span style="color:#C9D1D9;">4 </span><span style="color:#79C0FF;">32k</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u9AD8\u8D1F\u8377\u4E0B\u7F13\u51B2\u5927\u5C0F\uFF08proxy_buffers*2\uFF09</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_busy_buffers_size </span><span style="color:#C9D1D9;">64k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8BBE\u7F6E\u5728\u5199\u5165proxy_temp_path\u65F6\u6570\u636E\u7684\u5927\u5C0F\uFF0C\u9884\u9632\u4E00\u4E2A\u5DE5\u4F5C\u8FDB\u7A0B\u5728\u4F20\u9012\u6587\u4EF6\u65F6\u963B\u585E\u592A\u957F</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u7F13\u5B58\u6587\u4EF6\u5939\u5927\u5C0F\uFF0C\u5927\u4E8E\u8FD9\u4E2A\u503C\uFF0C\u5C06\u4ECEupstream\u670D\u52A1\u5668\u4F20</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_temp_file_write_size </span><span style="color:#C9D1D9;">64k;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">#\u7981\u6B62\u8BBF\u95EE .htxxx \u6587\u4EF6</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">/.ht </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> deny </span><span style="color:#C9D1D9;">all;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"></span></code></pre></div><h4 id="\u53C2\u8003\u6587\u6863" tabindex="-1">\u53C2\u8003\u6587\u6863 <a class="header-anchor" href="#\u53C2\u8003\u6587\u6863" aria-hidden="true">#</a></h4><ul><li>nginx \u4E2D\u6587\u6587\u6863\uFF1A<a href="https://docshome.gitbook.io/nginx-docs/" target="_blank" rel="noreferrer">https://docshome.gitbook.io/nginx-docs/</a></li><li>location \u5339\u914D\u89C4\u5219\uFF1A<a href="https://www.cnblogs.com/woshimrf/p/nginx-config-location.html" title="https://www.cnblogs.com/woshimrf/p/nginx-config-location.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/woshimrf/p/nginx-config-location.html</a></li></ul><h3 id="ty-store-\u793A\u4F8B" tabindex="-1">TY-Store \u793A\u4F8B <a class="header-anchor" href="#ty-store-\u793A\u4F8B" aria-hidden="true">#</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">user </span><span style="color:#C9D1D9;"> nginx;</span></span>
<span class="line"><span style="color:#FF7B72;">worker_processes </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">4</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#FF7B72;">error_log </span><span style="color:#C9D1D9;"> /var/log/nginx/error.log</span><span style="color:#79C0FF;"> warn</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#FF7B72;">pid </span><span style="color:#C9D1D9;">     /var/run/nginx.pid;</span></span>
<span class="line"><span style="color:#FF7B72;">events</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> worker_connections </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">1024</span><span style="color:#C9D1D9;">; </span><span style="color:#8B949E;"># \u6BCF\u4E2A\u8FDB\u7A0B\u5141\u8BB8\u7684\u6700\u5927\u8FDE\u63A5\u6570</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"><span style="color:#FF7B72;">http</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> include </span><span style="color:#C9D1D9;">      /etc/nginx/mime.types;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> default_type </span><span style="color:#C9D1D9;"> application/octet-stream;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">#\u8BBE\u5B9A\u65E5\u5FD7\u683C\u5F0F</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> log_format </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">  </span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#C9D1D9;">remote_addr</span><span style="color:#A5D6FF;"> - $</span><span style="color:#C9D1D9;">remote_user</span><span style="color:#A5D6FF;"> [$</span><span style="color:#C9D1D9;">time_local</span><span style="color:#A5D6FF;">] &quot;$</span><span style="color:#C9D1D9;">request</span><span style="color:#A5D6FF;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">                        </span><span style="color:#A5D6FF;">&#39;$</span><span style="color:#C9D1D9;">status</span><span style="color:#A5D6FF;"> $</span><span style="color:#C9D1D9;">body_bytes_sent</span><span style="color:#A5D6FF;"> &quot;$</span><span style="color:#C9D1D9;">http_referer</span><span style="color:#A5D6FF;">&quot; &#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">                        </span><span style="color:#A5D6FF;">&#39;&quot;$</span><span style="color:#C9D1D9;">http_user_agent</span><span style="color:#A5D6FF;">&quot; &quot;$</span><span style="color:#C9D1D9;">http_x_forwarded_for</span><span style="color:#A5D6FF;">&quot;&#39;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> access_log </span><span style="color:#C9D1D9;"> /var/log/nginx/access.log </span><span style="color:#79C0FF;"> main</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;">100M;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> client_body_buffer_size </span><span style="color:#C9D1D9;">100M;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># \u8FD9\u4E2A\u6307\u4EE4\u6307\u5B9A\u662F\u5426\u4F20\u90124xx\u548C5xx\u9519\u8BEF\u4FE1\u606F\u5230\u5BA2\u6237\u7AEF\uFF0C\u6216\u8005\u5141\u8BB8nginx\u4F7F\u7528error_page\u5904\u7406\u9519\u8BEF\u4FE1\u606F\u3002\u4F60\u5FC5\u987B\u660E\u786E\u7684\u5728error_page\u4E2D\u6307\u5B9A\u5904\u7406\u65B9\u6CD5\u4F7F\u8FD9\u4E2A\u53C2\u6570\u6709\u6548</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> fastcgi_intercept_errors </span><span style="color:#C9D1D9;">on;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> server_tokens </span><span style="color:#C9D1D9;">off;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> sendfile </span><span style="color:#C9D1D9;">      </span><span style="color:#79C0FF;"> on</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">#tcp_nopush     on;</span></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;"> keepalive_timeout </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">120</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">#gzip  on;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">#include /etc/nginx/conf.d/*.conf;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">upstream</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">tms-services</span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 10.8.15.216:11001;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 10.8.15.217:11001;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#server 10.8.11.30:5700;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">upstream</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ops-services </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> 10.8.15.216:11000;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">server</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> listen </span><span style="color:#C9D1D9;">      </span><span style="color:#79C0FF;">80</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">   </span><span style="color:#FF7B72;"> server_name </span><span style="color:#C9D1D9;"> localhost;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header Content-Security-Policy &quot;script-src &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; &#39;self&#39;; style-src &#39;unsafe-inline&#39; &#39;self&#39;&quot;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header X-XSS-Protection &#39;1; mode=block&#39;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header X-Content-Type-Options &#39;nosniff&#39;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header X-Frame-Options SAMEORIGIN;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header Set-Cookie &quot;HttpOnly&quot;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header Set-Cookie &quot;Secure&quot;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header Strict-Transport-Security &quot;max-age=63072000;includeSubDomains;preload&quot;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header Cache-Control &#39;no-store, no-cache, must-revalidate, post-check=0, pre-check=0&#39;;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">#add_header Pragma no-cache;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($request_method </span><span style="color:#FF7B72;">!~* </span><span style="color:#C9D1D9;">GET|POST|DELETE) {</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">404</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($request_method </span><span style="color:#FF7B72;">!~* </span><span style="color:#C9D1D9;">GET|POST|DELETE) {</span></span>
<span class="line"><span style="color:#C9D1D9;">       </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">404</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~*</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">\\.(ini|cfg|dwt|lbi|lzma|arc)$ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">404</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">     }</span></span>
<span class="line"><span style="color:#C9D1D9;">     </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~*</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">/(modules|images|js|plugins|css)/$ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">404</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">~*</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">\\.(tar|gz|7z|bz|ace|uha|uda|zpaq)$ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">404</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ossfile </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($request_uri </span><span style="color:#FF7B72;">~* </span><span style="color:#A5D6FF;">^.*\\/(.*)\\.(java|txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|jpg|png|bin|tar)(\\?attname=([^&amp;]+))$</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">               </span><span style="color:#FF7B72;"> add_header </span><span style="color:#C9D1D9;">Content-Disposition </span><span style="color:#A5D6FF;">&quot;attachment;filename=$</span><span style="color:#C9D1D9;">arg_attname</span><span style="color:#A5D6FF;">&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">            }</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_next_upstream </span><span style="color:#C9D1D9;">http_502 http_504</span><span style="color:#79C0FF;"> error</span><span style="color:#C9D1D9;"> timeout invalid_header;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">https://whtypos-oss-sg.oss-ap-southeast-1.aliyuncs.com/ossfile;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> expires </span><span style="color:#C9D1D9;">30d;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/s3file </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($request_uri </span><span style="color:#FF7B72;">~* </span><span style="color:#A5D6FF;">^.*\\/(.*)\\.(java|txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|jpg|png|bin|tar)(\\?attname=([^&amp;]+))$</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">               </span><span style="color:#FF7B72;"> add_header </span><span style="color:#C9D1D9;">Content-Disposition </span><span style="color:#A5D6FF;">&quot;attachment;filename=$</span><span style="color:#C9D1D9;">arg_attname</span><span style="color:#A5D6FF;">&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">            }</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_next_upstream </span><span style="color:#C9D1D9;">http_502 http_504</span><span style="color:#79C0FF;"> error</span><span style="color:#C9D1D9;"> timeout invalid_header;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://10.8.40.233:30878/bluelinkup/s3file;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> expires </span><span style="color:#C9D1D9;">30d;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># root\u4E0Ealias\u533A\u522B</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># root\u793A\u4F8B\uFF1A\u8BF7\u6C42 http://127.0.0.1:80/blog/root.html \u8FD9\u4E2A\u5730\u5740\u65F6\uFF0C\u90A3\u4E48\u5728\u670D\u52A1\u5668\u91CC\u9762\u5BF9\u5E94\u7684\u771F\u6B63\u7684\u8D44\u6E90\u662F /usr/local/nginx/html/blog/root.html\u6587\u4EF6\u3002\u53EF\u4EE5\u53D1\u73B0\u771F\u5B9E\u7684\u8DEF\u5F84\u662Froot\u6307\u5B9A\u7684\u503C\u52A0\u4E0Alocation\u6307\u5B9A\u7684\u503C\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;"># alisa\u793A\u4F8B\uFF1A\u8BF7\u6C42http://127.0.0.1:80/blog/alias.html\u65F6\uFF0C\u5728\u670D\u52A1\u5668\u67E5\u627E\u7684\u8D44\u6E90\u8DEF\u5F84\u662F\uFF1A/usr/local/nginx/html/alias.html\u3002\u6B63\u5982\u5176\u540D\uFF0Calias\u6307\u5B9A\u7684\u8DEF\u5F84\u662Flocation\u7684\u522B\u540D\uFF0C\u4E0D\u7BA1location\u7684\u503C\u600E\u4E48\u5199\uFF0C\u8D44\u6E90\u7684\u771F\u5B9E\u8DEF\u5F84\u90FD\u662Falias\u6307\u5B9A\u7684\u8DEF\u5F84.\u3002</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ops/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> ($request_filename </span><span style="color:#FF7B72;">~* </span><span style="color:#C9D1D9;">.*\\.(?:htm|html)$) {</span></span>
<span class="line"><span style="color:#C9D1D9;">             </span><span style="color:#FF7B72;"> add_header </span><span style="color:#C9D1D9;">Cache-Control </span><span style="color:#A5D6FF;">&quot;private, no-store, no-cache, must-revalidate, proxy-revalidate&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">            }</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> alias </span><span style="color:#C9D1D9;"> /usr/share/nginx/html/ops/;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/services/tms </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://tms-services/;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Host $host;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">REMOTE-HOST $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">2000m</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_http_version </span><span style="color:#C9D1D9;">1.1;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Connection </span><span style="color:#A5D6FF;">&quot;upgrade&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/services/ops </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://ops-services/;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Host $host;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">REMOTE-HOST $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">2000m</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#8B949E;"># \u914D\u7F6Ewebsocket -------start---------</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_http_version </span><span style="color:#C9D1D9;">1.1;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Upgrade $http_upgrade;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Connection </span><span style="color:#A5D6FF;">&quot;upgrade&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_read_timeout </span><span style="color:#C9D1D9;">3600s;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_send_timeout </span><span style="color:#C9D1D9;">3600s;</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#8B949E;"># \u914D\u7F6Ewebsocket -------end---------</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> root </span><span style="color:#C9D1D9;"> /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> index </span><span style="color:#C9D1D9;"> index.html index.htm;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/help-center/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://10.8.15.216:22011/;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Host $host;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">REMOTE-HOST $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#C9D1D9;">           </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;">2000m;</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">location</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">/assistant/ </span><span style="color:#C9D1D9;">{</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_pass </span><span style="color:#C9D1D9;">http://10.8.15.216:9998/;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Host $host;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">REMOTE-HOST $remote_addr;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> client_max_body_size </span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">2000m</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#8B949E;"># \u914D\u7F6Ewebsocket -------start---------</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_http_version </span><span style="color:#C9D1D9;">1.1;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Upgrade $http_upgrade;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_set_header </span><span style="color:#C9D1D9;">Connection </span><span style="color:#A5D6FF;">&quot;upgrade&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_read_timeout </span><span style="color:#C9D1D9;">3600s;</span></span>
<span class="line"><span style="color:#C9D1D9;">         </span><span style="color:#FF7B72;"> proxy_send_timeout </span><span style="color:#C9D1D9;">3600s;</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#8B949E;"># \u914D\u7F6Ewebsocket -------end---------</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="nginx-\u53EF\u89C6\u5316\u914D\u7F6E" tabindex="-1">Nginx \u53EF\u89C6\u5316\u914D\u7F6E <a class="header-anchor" href="#nginx-\u53EF\u89C6\u5316\u914D\u7F6E" aria-hidden="true">#</a></h2><p>\u5DE5\u5177\uFF1A<a href="https://github.com/digitalocean/nginxconfig.io" title="https://github.com/digitalocean/nginxconfig.io" target="_blank" rel="noreferrer">https://github.com/digitalocean/nginxconfig.io</a></p><h2 id="\u8FDB\u9636\u5B66\u4E60\u8D44\u6599" tabindex="-1">\u8FDB\u9636\u5B66\u4E60\u8D44\u6599 <a class="header-anchor" href="#\u8FDB\u9636\u5B66\u4E60\u8D44\u6599" aria-hidden="true">#</a></h2><ul><li><a href="https://jspang.com/article/39" target="_blank" rel="noreferrer">\u4E00\u4E2A\u524D\u7AEF\u5FC5\u4F1A\u7684 Nginx \u514D\u8D39\u6559\u7A0B (\u5171 11 \u96C6)</a></li><li>\u6781\u5BA2\u65F6\u95F4\uFF1A<a href="https://time.geekbang.org/course/intro/100020301?tab=intro" title="Nginx \u6838\u5FC3\u77E5\u8BC6 150 \u8BB2" target="_blank" rel="noreferrer">Nginx \u6838\u5FC3\u77E5\u8BC6 150 \u8BB2</a></li></ul>`,181),D=[i];function y(C,F,d,g,h,_){return n(),a("div",null,D)}const x=s(r,[["render",y]]);export{B as __pageData,x as default};
