import{_ as s,o as n,c as a,a as l}from"./app.a6e5cdcc.js";const d=JSON.parse('{"title":"\u767B\u5F55\u6CE8\u518C","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u7528\u6237\u767B\u5F55","slug":"\u7528\u6237\u767B\u5F55","link":"#\u7528\u6237\u767B\u5F55","children":[]},{"level":2,"title":"\u7528\u6237\u9000\u51FA","slug":"\u7528\u6237\u9000\u51FA","link":"#\u7528\u6237\u9000\u51FA","children":[]}],"relativePath":"engineer/login.md","lastUpdated":1672571140000}'),p={name:"engineer/login.md"},o=l(`<h1 id="\u767B\u5F55\u6CE8\u518C" tabindex="-1">\u767B\u5F55\u6CE8\u518C <a class="header-anchor" href="#\u767B\u5F55\u6CE8\u518C" aria-hidden="true">#</a></h1><p>\u76EE\u7684\uFF1A\u53EA\u6709\u767B\u5F55\u7684\u7528\u6237\u624D\u53EF\u4EE5\u8FDB\u5165\u9875\u9762\u3002</p><blockquote><p>\u5982\u4F55\u5224\u65AD\u7528\u6237\u662F\u5426\u5DF2\u767B\u5F55\uFF1F</p></blockquote><p>\u7B54\uFF1A\u6BCF\u6B21\u7528\u6237\u767B\u5F55\u540E\uFF0C\u90FD\u4F1A\u628A token \u4FDD\u5B58\u5728 locakStorage \u4E2D\uFF0C\u7136\u540E\u8BBE\u7F6E<code>router.beforeEach</code>\u5728\u8FDB\u5165\u67D0\u4E2A\u9875\u9762\u65F6\uFF0C\u68C0\u67E5\u672C\u5730 token \u662F\u5426\u5B58\u5728\uFF0C\u4E0D\u5B58\u5728\u5C31\u8DF3\u8F6C\u5230\u767B\u5F55\u9875\u9762\u3002</p><h2 id="\u7528\u6237\u767B\u5F55" tabindex="-1">\u7528\u6237\u767B\u5F55 <a class="header-anchor" href="#\u7528\u6237\u767B\u5F55" aria-hidden="true">#</a></h2><p>\u5F53\u7528\u6237\u70B9\u51FB\u767B\u5F55\u6309\u94AE\u7684\u65F6\u5019\uFF0C</p><ol><li>\u9996\u5148\u6821\u9A8C\u8868\u5355;</li><li>\u8C03\u7528 stores \u4E2D\u7684\u767B\u5F55\u65B9\u6CD5.</li></ol><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#FF7B72;">import</span><span style="color:#C9D1D9;"> { useAppStore } </span><span style="color:#FF7B72;">from</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&quot;@/stores&quot;</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">appStore</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">useAppStore</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// \u767B\u5F55</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">handleLogin</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">async</span><span style="color:#C9D1D9;"> () </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> formRef.value?.</span><span style="color:#D2A8FF;">validate</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    submitLoading.value </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> appStore.</span><span style="color:#D2A8FF;">login</span><span style="color:#C9D1D9;">(formData.value);</span></span>
<span class="line"><span style="color:#C9D1D9;">    window.$message.</span><span style="color:#D2A8FF;">success</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;\u767B\u5F55\u6210\u529F&quot;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (err) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">// \u5931\u8D25\u7684\u8BDD\uFF0C\u9700\u8981\u8F93\u5165\u9A8C\u8BC1\u7801</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#D2A8FF;">loadCaptcha</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">    console.</span><span style="color:#D2A8FF;">error</span><span style="color:#C9D1D9;">(err);</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">finally</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    submitLoading.value </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">false</span><span style="color:#C9D1D9;">;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">};</span></span>
<span class="line"></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>\u9A8C\u8BC1\u7801\u529F\u80FD\u9700\u8981\u540E\u7AEF\u751F\u6210\uFF0C\u800C\u4E0D\u5E94\u8BE5\u662F\u524D\u7AEF\u751F\u6210\u3002 \u53C2\u8003\uFF1A<a href="https://v2ex.com/t/729665" target="_blank" rel="noreferrer">https://v2ex.com/t/729665</a></p></div><p>\u5728 stores \u4E2D\u767B\u5F55\u4F1A\u8C03\u7528\u767B\u5F55\u63A5\u53E3\uFF0C\u767B\u9646\u5B8C\u540E\uFF1A</p><ol><li>\u8BBE\u7F6E\u8BF7\u6C42 header\uFF0C\u6BCF\u6B21\u90FD\u643A\u5E26 token \u4FE1\u606F</li><li>\u83B7\u53D6\u4E2A\u4EBA\u4FE1\u606F\uFF0C\u5B58\u50A8\u5728 store\uFF08\u6B64\u65F6\u4E5F\u53EF\u4EE5\u83B7\u53D6\u83DC\u5355 menuList\uFF09</li><li>\u8DF3\u8F6C\u5230\u9996\u9875\u3002</li></ol><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#8B949E;">// stores\u4E2D\u7684\u767B\u5F55</span></span>
<span class="line"><span style="color:#C9D1D9;">async </span><span style="color:#D2A8FF;">login</span><span style="color:#C9D1D9;">(data) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">token</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> window.$apis.common.</span><span style="color:#D2A8FF;">login</span><span style="color:#C9D1D9;">(data);</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.token </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> token;</span></span>
<span class="line"><span style="color:#C9D1D9;">  localMng.</span><span style="color:#D2A8FF;">setItem</span><span style="color:#C9D1D9;">(TokenName, token);</span></span>
<span class="line"><span style="color:#C9D1D9;">  request.</span><span style="color:#D2A8FF;">setHeader</span><span style="color:#C9D1D9;">({</span></span>
<span class="line"><span style="color:#C9D1D9;">    Authorization: token,</span></span>
<span class="line"><span style="color:#C9D1D9;">  });</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">getUserInfo</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  router.</span><span style="color:#D2A8FF;">push</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;/home&quot;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">},</span></span>
<span class="line"></span></code></pre></div><h2 id="\u7528\u6237\u9000\u51FA" tabindex="-1">\u7528\u6237\u9000\u51FA <a class="header-anchor" href="#\u7528\u6237\u9000\u51FA" aria-hidden="true">#</a></h2><p>\u5728\u7528\u6237\u9000\u51FA\u540E\uFF0C\u9700\u8981\u6E05\u7406 session\uFF0C\u6E05\u9664 token\uFF0C\u6E05\u9664\u8BF7\u6C42\u5934\uFF0C\u7136\u540E\u8FD8\u539F store\u3002</p><div class="language-tsx"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki"><code><span class="line"><span style="color:#8B949E;">//  \u9000\u51FA</span></span>
<span class="line"><span style="color:#C9D1D9;">async </span><span style="color:#D2A8FF;">logout</span><span style="color:#C9D1D9;">(isRequest </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (isRequest) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">await</span><span style="color:#C9D1D9;"> window.$apis.common.</span><span style="color:#D2A8FF;">logout</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  console.</span><span style="color:#D2A8FF;">log</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;logout&quot;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">  router.</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&quot;/login&quot;</span><span style="color:#C9D1D9;">);</span></span>
<span class="line"><span style="color:#C9D1D9;">  sessionMng.</span><span style="color:#D2A8FF;">clear</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">  localMng.</span><span style="color:#D2A8FF;">removeItem</span><span style="color:#C9D1D9;">(TokenName);</span></span>
<span class="line"><span style="color:#C9D1D9;">  request.</span><span style="color:#D2A8FF;">setHeader</span><span style="color:#C9D1D9;">({</span></span>
<span class="line"><span style="color:#C9D1D9;">    Authorization: </span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  });</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// \u8FD8\u539Fstore</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">.</span><span style="color:#D2A8FF;">$reset</span><span style="color:#C9D1D9;">();</span></span>
<span class="line"><span style="color:#C9D1D9;">},</span></span>
<span class="line"></span></code></pre></div>`,15),e=[o];function t(c,r,D,y,i,F){return n(),a("div",null,e)}const u=s(p,[["render",t]]);export{d as __pageData,u as default};
